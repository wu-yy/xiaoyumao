!function(){window.BDWM||(window.BDWM={}),window.BDWM.storage={};var e="main_";1==window.test&&(e="test_"),window.BDWM.storage.get=function(t,i){var n=null;return localStorage&&(n=localStorage.getItem(e+window.username+"_"+t)),null===n&&"undefined"!=typeof i?i:n},window.BDWM.storage.set=function(t,i){localStorage&&localStorage.setItem(e+window.username+"_"+t,i)},window.BDWM.storage.remove=function(t){localStorage&&localStorage.removeItem(e+window.username+"_"+t)},window.BDWM.storage.available=!!window.localStorage}(),function(e){Array.prototype.map||(Array.prototype.map=function(e,t){var i,n,a;if(null==this)throw new TypeError(" this is null or not defined");var r=Object(this),o=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(t&&(i=t),n=Array(o),a=0;o>a;){var s,d;a in r&&(s=r[a],d=e.call(i,s,a,r),n[a]=d),a++}return n});var t=e.detect=function(){var e=function(){},t={browser_parsers:[{regex:"^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",family_replacement:"Wii",manufacturer:"Nintendo"},{regex:"(SeaMonkey|Camino)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Camino",other:!0},{regex:"(Pale[Mm]oon)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Pale Moon (Firefox Variant)",other:!0},{regex:"(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",family_replacement:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)(pre)",family_replacment:"Firefox Mobile"},{regex:"(Fennec)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"Mobile.*(Firefox)/(\\d+)\\.(\\d+)",family_replacement:"Firefox Mobile"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",family_replacement:"Firefox ($1)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",family_replacement:"Firefox Alpha"},{regex:"(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",family_replacement:"Firefox Beta"},{regex:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",family_replacement:"Firefox ($1)"},{regex:"(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"MicroB",tablet:!0},{regex:"(MozillaDeveloperPreview)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?"},{regex:"(Flock)/(\\d+)\\.(\\d+)(b\\d+?)",family_replacement:"Flock",other:!0},{regex:"(RockMelt)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Rockmelt",other:!0},{regex:"(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",family_replacement:"Netscape"},{regex:"(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Netscape"},{regex:"(MyIBrow)/(\\d+)\\.(\\d+)",family_replacement:"My Internet Browser",other:!0},{regex:"(Opera Tablet).*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera Tablet",tablet:!0},{regex:"(Opera)/.+Opera Mobi.+Version/(\\d+)\\.(\\d+)",family_replacement:"Opera Mobile"},{regex:"Opera Mobi",family_replacement:"Opera Mobile"},{regex:"(Opera Mini)/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera Mini)/att/(\\d+)\\.(\\d+)",family_replacement:"Opera Mini"},{regex:"(Opera)/9.80.*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(OPR)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",family_replacement:"Opera"},{regex:"(webOSBrowser)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(webOS)/(\\d+)\\.(\\d+)",family_replacement:"webOS"},{regex:"(wOSBrowser).+TouchPad/(\\d+)\\.(\\d+)",family_replacement:"webOS TouchPad"},{regex:"(luakit)",family_replacement:"LuaKit",other:!0},{regex:"(Lightning)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)",family_replacement:"Lightning",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",family_replacement:"Swiftfox",other:!0},{regex:"rekonq",family_replacement:"Rekonq",other:!0},{regex:"(conkeror|Conkeror)/(\\d+)\\.(\\d+)\\.?(\\d+)?",family_replacement:"Conkeror",other:!0},{regex:"(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Konqueror",other:!0},{regex:"(WeTab)-Browser",family_replacement:"WeTab",other:!0},{regex:"(Comodo_Dragon)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Comodo Dragon",other:!0},{regex:"(YottaaMonitor)",family_replacement:"Yottaa Monitor",other:!0},{regex:"(Kindle)/(\\d+)\\.(\\d+)",family_replacement:"Kindle"},{regex:"(Symphony) (\\d+).(\\d+)",family_replacement:"Symphony",other:!0},{regex:"Minimo",family_replacement:"Minimo",other:!0},{regex:"(Edge)/(\\d+)\\.(\\d+)",family_replacement:"Edge"},{regex:"(CrMo)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile"},{regex:"(CriOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Mobile iOS"},{regex:"(Chrome)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+) Mobile",family_replacement:"Chrome Mobile"},{regex:"(chromeframe)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Chrome Frame"},{regex:"(UC Browser)(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"UC Browser",other:!0},{regex:"(SLP Browser)/(\\d+)\\.(\\d+)",family_replacement:"Tizen Browser",other:!0},{regex:"(Epiphany)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"Epiphany",other:!0},{regex:"(SE 2\\.X) MetaSr (\\d+)\\.(\\d+)",family_replacement:"Sogou Explorer",other:!0},{regex:"(Pingdom.com_bot_version_)(\\d+)\\.(\\d+)",family_replacement:"PingdomBot",other:!0},{regex:"(facebookexternalhit)/(\\d+)\\.(\\d+)",family_replacement:"FacebookBot"},{regex:"(Twitterbot)/(\\d+)\\.(\\d+)",family_replacement:"TwitterBot"},{regex:"(AdobeAIR|Chromium|FireWeb|Jasmine|ANTGalio|Midori|Fresco|Lobo|PaleMoon|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|WebPilot|NetFront|Netfront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|ThunderBrowse|Iron|Iris|UP\\.Browser|Bunjaloo|Google Earth|Raven for Mac)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Bolt|Jasmine|IceCat|Skyfire|Midori|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|NetFront|Netfront|Konqueror|Googlebot|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca|Dolfin|BOLT|Minimo|Tizen Browser|Polaris)/(\\d+)\\.(\\d+)"},{regex:"(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(iCab|Lunascape|Opera|Android|Jasmine|Polaris|BREW) (\\d+)\\.(\\d+)\\.?(\\d+)?"},{regex:"(Android) Donut",v2_replacement:"2",v1_replacement:"1"},{regex:"(Android) Eclair",v2_replacement:"1",v1_replacement:"2"},{regex:"(Android) Froyo",v2_replacement:"2",v1_replacement:"2"},{regex:"(Android) Gingerbread",v2_replacement:"3",v1_replacement:"2"},{regex:"(Android) Honeycomb",v1_replacement:"3"},{regex:"(IEMobile)[ /](\\d+)\\.(\\d+)",family_replacement:"IE Mobile"},{regex:"(MSIE) (\\d+)\\.(\\d+).*XBLWP7",family_replacement:"IE Large Screen"},{regex:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"},{regex:"(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"},{regex:"(Obigo)InternetBrowser",other:!0},{regex:"(Obigo)\\-Browser",other:!0},{regex:"(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",other:!0},{regex:"(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",family_replacement:"Maxthon",other:!0},{regex:"(Maxthon|MyIE2|Uzbl|Shiira)",v1_replacement:"0",other:!0},{regex:"(PLAYSTATION) (\\d+)",family_replacement:"PlayStation",manufacturer:"Sony"},{regex:"(PlayStation Portable)[^\\d]+(\\d+).(\\d+)",manufacturer:"Sony"},{regex:"(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(POLARIS)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(Embider)/(\\d+)\\.(\\d+)",family_replacement:"Polaris",other:!0},{regex:"(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Bon Echo",other:!0},{regex:"(iPod).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPod)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPhone)",family_replacement:"Mobile Safari",manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad).*Version/(\\d+)\\.(\\d+)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(iPad)",family_replacement:"Mobile Safari",tablet:!0,manufacturer:"Apple"},{regex:"(AvantGo) (\\d+).(\\d+)",other:!0},{regex:"(Avant)",v1_replacement:"1",other:!0},{regex:"^(Nokia)",family_replacement:"Nokia Services (WAP) Browser",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)",manufacturer:"Nokia"},{regex:"(NokiaBrowser)/(\\d+)\\.(\\d+)",manufacturer:"Nokia"},{regex:"(BrowserNG)/(\\d+)\\.(\\d+).(\\d+)",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/5\\.0",v2_replacement:"0",v1_replacement:"7",family_replacement:"NokiaBrowser",manufacturer:"Nokia"},{regex:"(Series60)/(\\d+)\\.(\\d+)",family_replacement:"Nokia OSS Browser",manufacturer:"Nokia"},{regex:"(S40OviBrowser)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Nokia Series 40 Ovi Browser",manufacturer:"Nokia"},{regex:"(Nokia)[EN]?(\\d+)",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS (\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",tablet:!0,manufacturer:"Nokia"},{regex:"(Black[bB]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",family_replacement:"Blackberry WebKit",manufacturer:"RIM"},{regex:"(Black[bB]erry)\\s?(\\d+)",family_replacement:"Blackberry",manufacturer:"RIM"},{regex:"(OmniWeb)/v(\\d+)\\.(\\d+)",other:!0},{regex:"(Blazer)/(\\d+)\\.(\\d+)",family_replacement:"Palm Blazer",manufacturer:"Palm"},{regex:"(Pre)/(\\d+)\\.(\\d+)",family_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Links) \\((\\d+)\\.(\\d+)",other:!0},{regex:"(QtWeb) Internet Browser/(\\d+)\\.(\\d+)",other:!0},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",other:!0,tablet:!0},{regex:"(AppleWebKit)/(\\d+)\\.?(\\d+)?\\+ .* Version/\\d+\\.\\d+.\\d+ Safari/",family_replacement:"WebKit Nightly"},{regex:"(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",family_replacement:"Safari"},{regex:"(Safari)/\\d+"},{regex:"(OLPC)/Update(\\d+)\\.(\\d+)",other:!0},{regex:"(OLPC)/Update()\\.(\\d+)",v1_replacement:"0",other:!0},{regex:"(SEMC\\-Browser)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Teleca)",family_replacement:"Teleca Browser",other:!0},{regex:"Trident(.*)rv.(\\d+)\\.(\\d+)",family_replacement:"IE"},{regex:"(MSIE) (\\d+)\\.(\\d+)",family_replacement:"IE"}],os_parsers:[{regex:"(Android) (\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android)\\-(\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"},{regex:"(Android) Donut",os_v2_replacement:"2",os_v1_replacement:"1"},{regex:"(Android) Eclair",os_v2_replacement:"1",os_v1_replacement:"2"},{regex:"(Android) Froyo",os_v2_replacement:"2",os_v1_replacement:"2"},{regex:"(Android) Gingerbread",os_v2_replacement:"3",os_v1_replacement:"2"},{regex:"(Android) Honeycomb",os_v1_replacement:"3"},{regex:"(Silk-Accelerated=[a-z]{4,5})",os_replacement:"Android"},{regex:"(Windows Phone 6\\.5)"},{regex:"(Windows (?:NT 5\\.2|NT 5\\.1))",os_replacement:"Windows XP"},{regex:"(XBLWP7)",os_replacement:"Windows Phone OS"},{regex:"(Windows NT 6\\.1)",os_replacement:"Windows 7"},{regex:"(Windows NT 6\\.0)",os_replacement:"Windows Vista"},{regex:"(Windows 98|Windows XP|Windows ME|Windows 95|Windows CE|Windows 7|Windows NT 4\\.0|Windows Vista|Windows 2000)"},{regex:"(Windows NT 6\\.4|Windows NT 10\\.0)",os_replacement:"Windows 10"},{regex:"(Windows NT 6\\.2)",os_replacement:"Windows 8"},{regex:"(Windows Phone 8)",os_replacement:"Windows Phone 8"},{regex:"(Windows NT 5\\.0)",os_replacement:"Windows 2000"},{regex:"(Windows Phone OS) (\\d+)\\.(\\d+)"},{regex:"(Windows ?Mobile)",os_replacement:"Windows Mobile"},{regex:"(WinNT4.0)",os_replacement:"Windows NT 4.0"},{regex:"(Win98)",os_replacement:"Windows 98"},{regex:"(Tizen)/(\\d+)\\.(\\d+)",other:!0},{regex:"(Mac OS X) (\\d+)[_.](\\d+)(?:[_.](\\d+))?",manufacturer:"Apple"},{regex:"(?:PPC|Intel) (Mac OS X)",manufacturer:"Apple"},{regex:"(CPU OS|iPhone OS) (\\d+)_(\\d+)(?:_(\\d+))?",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod); Opera",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(iPad); Opera",tablet:!0,manufacturer:"Apple"},{regex:"(iPhone|iPad|iPod).*Mac OS X.*Version/(\\d+)\\.(\\d+)",os_replacement:"iOS",manufacturer:"Apple"},{regex:"(CrOS) [a-z0-9_]+ (\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"Chrome OS"},{regex:"(Debian)-(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Linux Mint)(?:/(\\d+))?",other:!0},{regex:"(Mandriva)(?: Linux)?/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",other:!0},{regex:"(Symbian[Oo][Ss])/(\\d+)\\.(\\d+)",os_replacement:"Symbian OS"},{regex:"(Symbian/3).+NokiaBrowser/7\\.3",os_replacement:"Symbian^3 Anna"},{regex:"(Symbian/3).+NokiaBrowser/7\\.4",os_replacement:"Symbian^3 Belle"},{regex:"(Symbian/3)",os_replacement:"Symbian^3"},{regex:"(Series 60|SymbOS|S60)",os_replacement:"Symbian OS"},{regex:"(MeeGo)",other:!0},{regex:"Symbian [Oo][Ss]",os_replacement:"Symbian OS"},{regex:"(Black[Bb]erry)[0-9a-z]+/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(Black[Bb]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"BlackBerry OS",manufacturer:"RIM"},{regex:"(RIM Tablet OS) (\\d+)\\.(\\d+)\\.(\\d+)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Play[Bb]ook)",os_replacement:"BlackBerry Tablet OS",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry)",os_replacement:"Blackberry OS",manufacturer:"RIM"},{regex:"(webOS|hpwOS)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",os_replacement:"webOS"},{regex:"(SUSE|Fedora|Red Hat|PCLinuxOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(SUSE|Fedora|Red Hat|Puppy|PCLinuxOS|CentOS)/(\\d+)\\.(\\d+)\\.(\\d+)",other:!0},{regex:"(Ubuntu|Kindle|Bada|Lubuntu|BackTrack|Red Hat|Slackware)/(\\d+)\\.(\\d+)"},{regex:"(Windows|OpenBSD|FreeBSD|NetBSD|Ubuntu|Kubuntu|Android|Arch Linux|CentOS|WeTab|Slackware)"},{regex:"(Linux|BSD)",other:!0}],mobile_os_families:["Windows Phone 6.5","Windows CE","Symbian OS"],device_parsers:[{regex:"HTC ([A-Z][a-z0-9]+) Build",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Z][a-z0-9 ]+) \\d+\\.\\d+\\.\\d+\\.\\d+",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_Touch_([A-Za-z0-9]+)",device_replacement:"HTC Touch ($1)",manufacturer:"HTC"},{regex:"USCCHTC(\\d+)",device_replacement:"HTC $1 (US Cellular)",manufacturer:"HTC"},{regex:"Sprint APA(9292)",device_replacement:"HTC $1 (Sprint)",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+ [A-Z])",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC-([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC_([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"HTC ([A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(ADR[A-Za-z0-9]+)",device_replacement:"HTC $1",manufacturer:"HTC"},{regex:"(HTC)",manufacturer:"HTC"},{regex:"SonyEricsson([A-Za-z0-9]+)/",device_replacement:"Ericsson $1",other:!0,manufacturer:"Sony"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; WOWMobile (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\-update1\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"},{regex:"Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; (.+) Build"},{regex:"NokiaN([0-9]+)",device_replacement:"Nokia N$1",manufacturer:"Nokia"},{regex:"Nokia([A-Za-z0-9\\v-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"NOKIA ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Nokia ([A-Za-z0-9\\-]+)",device_replacement:"Nokia $1",manufacturer:"Nokia"},{regex:"Lumia ([A-Za-z0-9\\-]+)",device_replacement:"Lumia $1",manufacturer:"Nokia"},{regex:"Symbian",device_replacement:"Nokia",manufacturer:"Nokia"},{regex:"(PlayBook).+RIM Tablet OS",device_replacement:"Blackberry Playbook",tablet:!0,manufacturer:"RIM"},{regex:"(Black[Bb]erry [0-9]+);",manufacturer:"RIM"},{regex:"Black[Bb]erry([0-9]+)",device_replacement:"BlackBerry $1",manufacturer:"RIM"},{regex:"(Pre)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pre",manufacturer:"Palm"},{regex:"(Pixi)/(\\d+)\\.(\\d+)",device_replacement:"Palm Pixi",manufacturer:"Palm"},{regex:"(Touchpad)/(\\d+)\\.(\\d+)",device_replacement:"HP Touchpad",manufacturer:"HP"},{regex:"HPiPAQ([A-Za-z0-9]+)/(\\d+).(\\d+)",device_replacement:"HP iPAQ $1",manufacturer:"HP"},{regex:"Palm([A-Za-z0-9]+)",device_replacement:"Palm $1",manufacturer:"Palm"},{regex:"Treo([A-Za-z0-9]+)",device_replacement:"Palm Treo $1",manufacturer:"Palm"},{regex:"webOS.*(P160UNA)/(\\d+).(\\d+)",device_replacement:"HP Veer",manufacturer:"HP"},{regex:"(Kindle Fire)",manufacturer:"Amazon"},{regex:"(Kindle)",manufacturer:"Amazon"},{regex:"(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",device_replacement:"Kindle Fire",tablet:!0,manufacturer:"Amazon"},{regex:"(iPad) Simulator;",manufacturer:"Apple"},{regex:"(iPad);",manufacturer:"Apple"},{regex:"(iPod);",manufacturer:"Apple"},{regex:"(iPhone) Simulator;",manufacturer:"Apple"},{regex:"(iPhone);",manufacturer:"Apple"},{regex:"Nexus\\ ([A-Za-z0-9\\-]+)",device_replacement:"Nexus $1"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"acer_([A-Za-z0-9]+)_",device_replacement:"Acer $1",manufacturer:"Acer"},{regex:"Amoi\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"AMOI\\-([A-Za-z0-9]+)",device_replacement:"Amoi $1",other:!0,manufacturer:"Amoi"},{regex:"Asus\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"ASUS\\-([A-Za-z0-9]+)",device_replacement:"Asus $1",manufacturer:"Asus"},{regex:"BIRD\\-([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD\\.([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"BIRD ([A-Za-z0-9]+)",device_replacement:"Bird $1",other:!0},{regex:"Dell ([A-Za-z0-9]+)",device_replacement:"Dell $1",manufacturer:"Dell"},{regex:"DoCoMo/2\\.0 ([A-Za-z0-9]+)",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\_W\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"([A-Za-z0-9]+)\\;FOMA",device_replacement:"DoCoMo $1",other:!0},{regex:"vodafone([A-Za-z0-9]+)",device_replacement:"Huawei Vodafone $1",other:!0},{regex:"i\\-mate ([A-Za-z0-9]+)",device_replacement:"i-mate $1",other:!0},{regex:"Kyocera\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"KWC\\-([A-Za-z0-9]+)",device_replacement:"Kyocera $1",other:!0},{regex:"Lenovo\\-([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Lenovo"},{regex:"Lenovo\\_([A-Za-z0-9]+)",device_replacement:"Lenovo $1",manufacturer:"Levovo"},{regex:"LG/([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE-LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE VX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG ([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE LG\\-AX([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LGE\\-([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"LG([A-Za-z0-9]+)",device_replacement:"LG $1",manufacturer:"LG"},{regex:"(KIN)\\.One (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(KIN)\\.Two (\\d+)\\.(\\d+)",device_replacement:"Microsoft $1"},{regex:"(Motorola)\\-([A-Za-z0-9]+)",manufacturer:"Motorola"},{regex:"MOTO\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"MOT\\-([A-Za-z0-9]+)",device_replacement:"Motorola $1",manufacturer:"Motorola"},{regex:"Philips([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"Philips ([A-Za-z0-9]+)",device_replacement:"Philips $1",manufacturer:"Philips"},{regex:"SAMSUNG-([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"SAMSUNG\\; ([A-Za-z0-9\\-]+)",device_replacement:"Samsung $1",manufacturer:"Samsung"},{regex:"Softbank/1\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"Softbank/2\\.0/([A-Za-z0-9]+)",device_replacement:"Softbank $1",other:!0},{regex:"(hiptop|avantgo|plucker|xiino|blazer|elaine|up.browser|up.link|mmp|smartphone|midp|wap|vodafone|o2|pocket|mobile|pda)",device_replacement:"Generic Smartphone"},{regex:"^(1207|3gso|4thp|501i|502i|503i|504i|505i|506i|6310|6590|770s|802s|a wa|acer|acs\\-|airn|alav|asus|attw|au\\-m|aur |aus |abac|acoo|aiko|alco|alca|amoi|anex|anny|anyw|aptu|arch|argo|bell|bird|bw\\-n|bw\\-u|beck|benq|bilb|blac|c55/|cdm\\-|chtm|capi|comp|cond|craw|dall|dbte|dc\\-s|dica|ds\\-d|ds12|dait|devi|dmob|doco|dopo|el49|erk0|esl8|ez40|ez60|ez70|ezos|ezze|elai|emul|eric|ezwa|fake|fly\\-|fly\\_|g\\-mo|g1 u|g560|gf\\-5|grun|gene|go.w|good|grad|hcit|hd\\-m|hd\\-p|hd\\-t|hei\\-|hp i|hpip|hs\\-c|htc |htc\\-|htca|htcg)",device_replacement:"Generic Feature Phone"},{regex:"^(htcp|htcs|htct|htc\\_|haie|hita|huaw|hutc|i\\-20|i\\-go|i\\-ma|i230|iac|iac\\-|iac/|ig01|im1k|inno|iris|jata|java|kddi|kgt|kgt/|kpt |kwc\\-|klon|lexi|lg g|lg\\-a|lg\\-b|lg\\-c|lg\\-d|lg\\-f|lg\\-g|lg\\-k|lg\\-l|lg\\-m|lg\\-o|lg\\-p|lg\\-s|lg\\-t|lg\\-u|lg\\-w|lg/k|lg/l|lg/u|lg50|lg54|lge\\-|lge/|lynx|leno|m1\\-w|m3ga|m50/|maui|mc01|mc21|mcca|medi|meri|mio8|mioa|mo01|mo02|mode|modo|mot |mot\\-|mt50|mtp1|mtv |mate|maxo|merc|mits|mobi|motv|mozz|n100|n101|n102|n202|n203|n300|n302|n500|n502|n505|n700|n701|n710|nec\\-|nem\\-|newg|neon)",device_replacement:"Generic Feature Phone"},{regex:"^(netf|noki|nzph|o2 x|o2\\-x|opwv|owg1|opti|oran|ot\\-s|p800|pand|pg\\-1|pg\\-2|pg\\-3|pg\\-6|pg\\-8|pg\\-c|pg13|phil|pn\\-2|pt\\-g|palm|pana|pire|pock|pose|psio|qa\\-a|qc\\-2|qc\\-3|qc\\-5|qc\\-7|qc07|qc12|qc21|qc32|qc60|qci\\-|qwap|qtek|r380|r600|raks|rim9|rove|s55/|sage|sams|sc01|sch\\-|scp\\-|sdk/|se47|sec\\-|sec0|sec1|semc|sgh\\-|shar|sie\\-|sk\\-0|sl45|slid|smb3|smt5|sp01|sph\\-|spv |spv\\-|sy01|samm|sany|sava|scoo|send|siem|smar|smit|soft|sony|t\\-mo|t218|t250|t600|t610|t618|tcl\\-|tdg\\-|telm|tim\\-|ts70|tsm\\-|tsm3|tsm5|tx\\-9|tagt)",device_replacement:"Generic Feature Phone"},{regex:"^(talk|teli|topl|tosh|up.b|upg1|utst|v400|v750|veri|vk\\-v|vk40|vk50|vk52|vk53|vm40|vx98|virg|vite|voda|vulc|w3c |w3c\\-|wapj|wapp|wapu|wapm|wig |wapi|wapr|wapv|wapy|wapa|waps|wapt|winc|winw|wonu|x700|xda2|xdag|yas\\-|your|zte\\-|zeto|aste|audi|avan|blaz|brew|brvw|bumb|ccwa|cell|cldc|cmd\\-|dang|eml2|fetc|hipt|http|ibro|idea|ikom|ipaq|jbro|jemu|jigs|keji|kyoc|kyok|libw|m\\-cr|midp|mmef|moto|mwbp|mywa|newt|nok6|o2im|pant|pdxg|play|pluc|port|prox|rozo|sama|seri|smal|symb|treo|upsi|vx52|vx53|vx60|vx61|vx70|vx80|vx81|vx83|vx85|wap\\-|webc|whit|wmlb|xda\\-|xda\\_)",device_replacement:"Generic Feature Phone"},{regex:"(bot|borg|google(^tv)|yahoo|slurp|msnbot|msrbot|openbot|archiver|netresearch|lycos|scooter|altavista|teoma|gigabot|baiduspider|blitzbot|oegp|charlotte|furlbot|http%20client|polybot|htdig|ichiro|mogimogi|larbin|pompos|scrubby|searchsight|seekbot|semanticdiscovery|silk|snappy|speedy|spider|voila|vortex|voyager|zao|zeal|fast\\-webcrawler|converacrawler|dataparksearch|findlinks)",device_replacement:"Spider"}],mobile_browser_families:["Firefox Mobile","Opera Mobile","Opera Mini","Mobile Safari","webOS","IE Mobile","Playstation Portable","Nokia","Blackberry","Palm","Silk","Android","Maemo","Obigo","Netfront","AvantGo","Teleca","SEMC-Browser","Bolt","Iris","UP.Browser","Symphony","Minimo","Bunjaloo","Jasmine","Dolfin","Polaris","BREW","Chrome Mobile","Chrome Mobile iOS","UC Browser","Tizen Browser"]};e.parsers=["device_parsers","browser_parsers","os_parsers","mobile_os_families","mobile_browser_families"],e.types=["browser","os","device"],e.regexes=t||function(){var t={};return e.parsers.map(function(e){t[e]=[]}),t}(),e.families=function(){var t={};return e.types.map(function(e){t[e]=[]}),t}();var i=Array.prototype,n=(Object.prototype,Function.prototype,i.forEach);i.indexOf;var a=function(e,t){for(var i={},n=0;t.length>n&&!(i=t[n](e));n++);return i},r=function(e,t){o(e,function(e){o(t,function(t){delete e[t]})})},o=forEach=function(e,t,i){if(null!=e)if(n&&e.forEach===n)e.forEach(t,i);else if(e.length===+e.length)for(var a=0,r=e.length;r>a;a++)t.call(i,e[a],a,e);else for(var o in e)_.has(e,o)&&t.call(i,e[o],o,e)},s=function(e){return!(!e||void 0===e||null==e)},d=function(e){var t="";return e=e||{},s(e)&&s(e.major)&&(t+=e.major,s(e.minor)&&(t+="."+e.minor,s(e.patch)&&(t+="."+e.patch))),t},c=function(e){e=e||{};var t=d(e);return t&&(t=" "+t),e&&s(e.family)?e.family+t:""};return e.parse=function(t){var i=function(t){return e.regexes[t+"_parsers"].map(function(e){function i(t){var i=t.match(n);if(!i)return null;var o={};return o.family=(a?a.replace("$1",i[1]):i[1])||"other",o.major=parseInt(r?r:i[2])||null,o.minor=i[3]?parseInt(i[3]):null,o.patch=i[4]?parseInt(i[4]):null,o.tablet=e.tablet,o.man=e.manufacturer||null,o}var n=RegExp(e.regex),a=e[("browser"===t?"family":t)+"_replacement"],r=e.major_version_replacement;return i})},n=function(){},o=i("browser"),l=i("os"),h=i("device"),p=new n;p.source=t,p.browser=a(t,o),s(p.browser)?(p.browser.name=c(p.browser),p.browser.version=d(p.browser)):p.browser={},p.os=a(t,l),s(p.os)?(p.os.name=c(p.os),p.os.version=d(p.os)):p.os={},p.device=a(t,h),s(p.device)?(p.device.name=c(p.device),p.device.version=d(p.device)):p.device={tablet:!1,family:"Other"};var m={};return e.regexes.mobile_browser_families.map(function(e){m[e]=!0}),e.regexes.mobile_os_families.map(function(e){m[e]=!0}),p.device.type="Spider"===p.browser.family?"Spider":p.browser.tablet||p.os.tablet||p.device.tablet?"Tablet":m.hasOwnProperty(p.browser.family)?"Mobile":"Desktop",p.device.manufacturer=p.browser.man||p.os.man||p.device.man||null,r([p.browser,p.os,p.device],["tablet","man"]),p},e}();"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.detect=t):e.detect=t,"function"==typeof define&&define.amd&&define(function(){return t})}(window),function(){"use strict";function e(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")}function t(e,t){var i=r(e,t)?s:o;i(e,t)}function i(e,t){if(!e)return!1;for(var i=e.target||e.srcElement||e||!1;i&&i!=t;)i=i.parentNode||!1;return i!==!1}function n(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function a(e,t){this.el=e,this.options=n({},this.options),n(this.options,t),this._init()}var r,o,s;"classList"in document.documentElement?(r=function(e,t){return e.classList.contains(t)},o=function(e,t){e.classList.add(t)},s=function(e,t){e.classList.remove(t)}):(r=function(t,i){return e(i).test(t.className)},o=function(e,t){r(e,t)||(e.className=e.className+" "+t)},s=function(t,i){t.className=t.className.replace(e(i)," ")});var d={hasClass:r,addClass:o,removeClass:s,toggleClass:t,has:r,add:o,remove:s,toggle:t};"function"==typeof define&&define.amd?define(d):window.classie=d,a.prototype.options={newTab:!0,stickyPlaceholder:!0,onChange:function(e){return!1}},a.prototype._init=function(){var e=this.el.querySelector("option[selected]");this.hasDefaultPlaceholder=e&&e.disabled,this.selectedOpt=e||this.el.querySelector("option"),this._createSelectEl(),this.selOpts=[].slice.call(this.selEl.querySelectorAll("li[data-option]")),this.selOptsCount=this.selOpts.length,this.current=this.selOpts.indexOf(this.selEl.querySelector("li.cs-selected"))||-1,this.selPlaceholder=this.selEl.querySelector("span.cs-placeholder"),this._initEvents()},a.prototype._createSelectEl=function(){var e="",t=function(e){var t="",i="",n="";return!e.selectedOpt||this.foundSelected||this.hasDefaultPlaceholder||(i+="cs-selected ",this.foundSelected=!0),e.getAttribute("data-class")&&(i+=e.getAttribute("data-class")),e.getAttribute("data-link")&&(n="data-link="+e.getAttribute("data-link")),""!==i&&(t='class="'+i+'" '),"<li "+t+n+' data-option data-value="'+e.value+'"><span>'+e.textContent+"</span></li>"};[].slice.call(this.el.children).forEach(function(i){if(!i.disabled){var n=i.tagName.toLowerCase();"option"===n?e+=t(i):"optgroup"===n&&(e+='<li class="cs-optgroup"><span>'+i.label+"</span><ul>",[].slice.call(i.children).forEach(function(i){e+=t(i)}),e+="</ul></li>")}});var i='<div class="cs-options"><ul>'+e+"</ul></div>";this.selEl=document.createElement("div"),this.selEl.className=this.el.className,this.selEl.tabIndex=this.el.tabIndex,this.selEl.innerHTML='<span class="cs-placeholder">'+this.selectedOpt.textContent+"</span>"+i,this.el.parentNode.appendChild(this.selEl),this.selEl.appendChild(this.el)},a.prototype._initEvents=function(){var e=this;this.selPlaceholder.addEventListener("click",function(){e._toggleSelect()}),this.selOpts.forEach(function(t,i){t.addEventListener("click",function(){e.current=i,e._changeOption(),e._toggleSelect()})}),document.addEventListener("click",function(t){var n=t.target;e._isOpen()&&n!==e.selEl&&!i(n,e.selEl)&&e._toggleSelect()}),this.selEl.addEventListener("keydown",function(t){var i=t.keyCode||t.which;switch(i){case 38:t.preventDefault(),e._navigateOpts("prev");break;case 40:t.preventDefault(),e._navigateOpts("next");break;case 32:t.preventDefault(),e._isOpen()&&"undefined"!=typeof e.preSelCurrent&&e.preSelCurrent!==-1&&e._changeOption(),e._toggleSelect();break;case 13:t.preventDefault(),e._isOpen()&&"undefined"!=typeof e.preSelCurrent&&e.preSelCurrent!==-1&&(e._changeOption(),e._toggleSelect());break;case 27:t.preventDefault(),e._isOpen()&&e._toggleSelect()}})},a.prototype._navigateOpts=function(e){this._isOpen()||this._toggleSelect();var t="undefined"!=typeof this.preSelCurrent&&this.preSelCurrent!==-1?this.preSelCurrent:this.current;("prev"===e&&t>0||"next"===e&&t<this.selOptsCount-1)&&(this.preSelCurrent="next"===e?t+1:t-1,this._removeFocus(),d.add(this.selOpts[this.preSelCurrent],"cs-focus"))},a.prototype._toggleSelect=function(){this._removeFocus(),this._isOpen()?(this.current!==-1&&(this.selPlaceholder.textContent=this.selOpts[this.current].textContent),d.remove(this.selEl,"cs-active")):(this.hasDefaultPlaceholder&&this.options.stickyPlaceholder&&(this.selPlaceholder.textContent=this.selectedOpt.textContent),d.add(this.selEl,"cs-active"))},a.prototype._changeOption=function(){"undefined"!=typeof this.preSelCurrent&&this.preSelCurrent!==-1&&(this.current=this.preSelCurrent,this.preSelCurrent=-1);var e=this.selOpts[this.current];this.selPlaceholder.textContent=e.textContent,this.el.value=e.getAttribute("data-value");var t=this.selEl.querySelector("li.cs-selected");t&&d.remove(t,"cs-selected"),d.add(e,"cs-selected"),e.getAttribute("data-link")&&(this.options.newTab?window.open(e.getAttribute("data-link"),"_blank"):window.location=e.getAttribute("data-link")),this.options.onChange(this.el.value)},a.prototype._isOpen=function(e){return d.has(this.selEl,"cs-active")},a.prototype._removeFocus=function(e){var t=this.selEl.querySelector("li.cs-focus");t&&d.remove(t,"cs-focus")},window.SelectFx=a}.call(this),function(e){window.BDWM||(window.BDWM={}),window.BDWM.inputLimit=function(t,i,n){e(t).on("change input",function(){var t=parseInt(e(this).prop("maxlength")),a=e(this).val(),r=0,o=a.length;if(a)for(var s=0;s<=o-1;s++)a.charCodeAt(s)>255&&r++,r++;i&&(r>t?e(i).html('<span style="color:#e97c62">超出 '+Math.ceil((r-t)/2)+" 个字</span>"):t-r<10?e(i).html('还可输入 <span style="color:#e97c62">'+Math.floor((t-r)/2)+"</span> 个字"):e(i).text("还可输入 "+Math.floor((t-r)/2)+" 个字")),
n&&(r>t?e(n).attr("disabled","disabled"):e(n).removeAttr("disabled"))}.bind(t))},window.BDWM.inputLimitCut=function(t){var i=parseInt(e(t).prop("maxlength")),n=e(t).val(),a=0,r=n.length,o=0;if(n)for(var s=0;s<=r-1;s++)if(n.charCodeAt(s)>255&&a++,a++,a>i){o=s;break}o>0&&e(this).val(n.substr(0,o))},window.BDWM.initSelect=function(t){e(t).data("init")&&(e(t).siblings().remove(),e(t).unwrap()),new SelectFx(t,{onChange:function(t){e(this).val(t),e(this).change()}.bind(t)}),e(t).attr("data-init","true")},window.BDWM.initQmd=function(t){var i=function(e){BDWM.storage.set("qmd",e)},n=function(){var e=BDWM.storage.get("qmd");return""==e||e||(e="random"),e};e(t).find("option").removeAttr("selected"),e(t).val(n());var a=e(t).find('option[value="'+n()+'"]');a&&0!=a.length?a.attr("selected","selected"):e(t).find('option[value=""]').attr("selected","selected"),e(t).change(function(){e(this).attr("data-signature-no-history")||i(e(this).val())})},window.BDWM.getCookie=function(e){var t,i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null},Date.prototype.pattern=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},i={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+i[this.getDay()+""]));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},window.BDWM.date2String=function(e){var t=new Date;return(t.getTime()-e.getTime())/864e5<1&&t.getDay()==e.getDay()?"今天 "+e.pattern("HH:mm"):(t.getTime()-e.getTime())/864e5<2&&(t.getDay()+7-e.getDay())%7==1?"昨天 "+e.pattern("HH:mm"):t.getFullYear()==e.getFullYear()?e.pattern("MM-dd HH:mm"):e.pattern("yyyy-MM-dd HH:mm")},window.BDWM.getCookie=function(e){var t,i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null},window.BDWM.setCookie=function(e,t){var i=new Date;i.setTime(i.getTime()-1);var n=window.BDWM.getCookie(e);null!=n&&(document.cookie=e+"="+n+";expires="+i.toGMTString(),document.cookie=e+"="+n+";path=/;expires="+i.toGMTString()),document.cookie=e+"="+t+";path=/",document.domain&&(document.cookie=e+"="+t+";path=/;domain=."+document.domain)},window.BDWM.ua=detect.parse(navigator.userAgent)}(jQuery),window.BDWM||(window.BDWM={}),window.BDWM.pjax||(window.BDWM.pjax={}),window.BDWM.pjax.initObj||(window.BDWM.pjax.initObj={}),window.BDWM.init=function(e,t){if(!e||""===e)return void $(document).on("ready pjax:end",function(){return t()});if(!window.BDWM.pjax.initObj[e])return window.BDWM.pjax.initObj[e]=t,$(document).on("ready pjax:end",function(){if($(e).size())return function(){return t()}()})},window.BDWM.redirect=function(e,t){return $.support.pjax?$.pjax({url:e,container:"#page-content",complete:t}):window.location.href=e},window.BDWM.reload=function(){return $.support.pjax?$.pjax.reload("#page-content"):window.location.reload()};var BDWM_ALERT_HTML,BDWM_CONFIRM_HTML,indexOf=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};window.BDWM||(window.BDWM={}),window.BDWM.Dialog=function(){function e(e,t){this["this"]=e,this.options=null!=t?t:{},"undefined"==typeof this.options.animateIn&&(this.options.animateIn=!0),"undefined"==typeof this.options.animateOut&&(this.options.animateOut=!0),"undefined"==typeof this.options.background&&(this.options.background=!0),"undefined"==typeof this.options.timeout&&(this.options.timeout=0),"undefined"==typeof this.options.callback&&(this.options.callback=function(){}),$(this["this"]).wrap('<div class="bdwm-dialog-wrapper" style="display: none"></div>').addClass("bdwm-dialog").data("dialog-initialized",1),this.wrapper=$(this["this"]).closest(".bdwm-dialog-wrapper").data("dialog",this),this.options.autoDeleteWhenPjax&&this.wrapper.attr("data-bdwm-dialog-auto-delete-when-pjax","true"),this.options.background&&this.wrapper.addClass("bdwm-dialog-wrapper-background"),this.wrapper.find('[data-action="dialog-dismiss"]').click(this.hide.bind(this)),this.bind=!1}return e.prototype.show=function(){return this.wrapper.data("show",1),this["this"].css({display:"inline-block"}),this.options.background&&$("body").css({overflow:"hidden"}),this.options.animateIn?(this.wrapper.stop().fadeIn("normal",this.doShow.bind(this)),this.adjustToCenter()):this.doShow()},e.prototype.preventScroll=function(e){var t,i;if(t=[33,34,35,36,38,39],"mousewheel"===e.type||"keydown"===e.type&&(i=e.keyCode,indexOf.call(t,i)>=0))return e.preventDefault(),e.stopPropagation(),!1},e.prototype.doShow=function(){if(this.callbacked=!1,this.wrapper.show(),this.options.background&&$("body").css({overflow:"hidden"}),this.adjustToCenter(),this.options.timeout&&setTimeout(this.hide.bind(this),this.options.timeout),!this.bind)return this.bind=!0,$(window).resize(this.adjustToCenter.bind(this)),this["this"].resize(this.adjustToCenter.bind(this))},e.prototype.hide=function(){if(this.wrapper.data("show"))return this.options.animateOut?this.wrapper.stop().fadeOut("normal",this.doHide.bind(this)):this.doHide()},e.prototype.doHide=function(){if(this.wrapper.hide(),this.options.background&&$("body").css({overflow:""}),this.wrapper.data("show",0),!this.callbacked)return this.options.callback(),this.callbacked=!0},e.prototype.adjustToCenter=function(){if(this.wrapper.data("show"))return this["this"].css({position:"absolute",left:($(window).width()-this["this"].width())/2,top:($(window).height()-this["this"].height()-100)/2})},e}(),BDWM_ALERT_HTML='<div class="bdwm-alert-dialog bdwm-dialog">\n  <span data-role=\'bdwm-alert-dialog-text\' class=\'bdwm-alert-dialog-text\'></span>\n  <a class="primary" data-action="bdwm-alert-dialog-dismiss">确认</a>\n</div>',window.BDWM.Alert=function(){function e(e){var t,i;this.options=null!=e?e:{},_.isString(this.options)&&(this.options={text:this.options}),"undefined"==typeof this.options.text&&(this.options.text=""),"undefined"==typeof this.options.animateIn&&(this.options.animateIn=!1),"undefined"==typeof this.options.animateOut&&(this.options.animateOut=!0),"undefined"==typeof this.options.background&&(this.options.background=!1),"undefined"==typeof this.options.timeout&&(this.options.timeout=0),"undefined"==typeof this.options.widthAuto&&(this.options.widthAuto=!1),this.options.autoDeleteWhenPjax=!0,this.alert=$(BDWM_ALERT_HTML),this.options.widthAuto&&this.alert.css("width","auto"),$("#page-content").length>0?$("#page-content").append(this.alert):$("body").append(this.alert),t=this.alert.find('[data-role="bdwm-alert-dialog-text"]'),this.options.widthAuto&&t.css("width","auto"),"undefined"!=typeof this.options.html?t.html(this.options.html):t.text(this.options.text),i=this,this.alert.find('[data-action="bdwm-alert-dialog-dismiss"]').click(this.hide.bind(this)),this.alert.bdwm_dialog(this.options).show(),$("body").keypress(function(e){if(13===e.keyCode)return i.hide.bind(i)(),!0})}return e.prototype.hide=function(){var e,t;try{return this.alert.bdwm_dialog().hide(),setTimeout(function(){return this.alert.closest(".bdwm-dialog-wrapper").remove()}.bind(this),2e3)}catch(t){return e=t,!1}},e}(),window.BDWM.alert=function(e){return new BDWM.Alert(e)},BDWM_CONFIRM_HTML='<div class="bdwm-confirm-dialog bdwm-dialog">\n  <div class=\'bdwm-confirm-dialog-content-wrapper\'>\n    <div class=\'bdwm-confirm-dialog-content\'>\n      <p class="bdwm-confirm-dialog-title" data-role=\'bdwm-confirm-dialog-title\'></p>\n      <p class="bdwm-confirm-dialog-text" data-role=\'bdwm-confirm-dialog-text\'></p>\n    </div>\n  </div>\n  <div class=\'bdwm-confirm-dialog-buttons\'>\n    <a class="primary" data-action="bdwm-confirm-dialog-yes">确认</a>\n    <a data-action="bdwm-confirm-dialog-no">取消</a>\n  </div>\n</div>',window.BDWM.Confirm=function(){function e(e){this.options=null!=e?e:{},_.isString(this.options)&&(this.options={text:this.options}),"undefined"==typeof this.options.text&&(this.options.text=""),"undefined"==typeof this.options.title&&(this.options.title=""),"undefined"==typeof this.options.animateIn&&(this.options.animateIn=!1),"undefined"==typeof this.options.animateOut&&(this.options.animateOut=!1),"undefined"==typeof this.options.background&&(this.options.background=!1),this.options.timeout=0,this.callback=this.options.callback,"undefined"==typeof this.callback&&(this.callback=function(){}),this.options.callback=function(){},this.options.autoDeleteWhenPjax=!0,this.confirm=$(BDWM_CONFIRM_HTML),$("#page-content").length>0?$("#page-content").append(this.confirm):$("body").append(this.confirm),this.confirm.find('[data-role="bdwm-confirm-dialog-text"]').html(this.options.text),this.confirm.find('[data-role="bdwm-confirm-dialog-title"]').html(this.options.title),this.confirm.find('[data-action="bdwm-confirm-dialog-yes"]').click(function(){return this.hide(!0)}.bind(this)),this.confirm.find('[data-action="bdwm-confirm-dialog-no"]').click(function(){return this.hide(!1)}.bind(this)),this.confirm.bdwm_dialog(this.options).show()}return e.prototype.hide=function(e){return this.confirm.bdwm_dialog().hide(),this.callback(e),setTimeout(function(){return this.confirm.closest(".bdwm-dialog-wrapper").remove()}.bind(this),2e3)},e}(),window.BDWM.confirm=function(e){return new BDWM.Confirm(e)},function(e){if(e.fn.bdwm_dialog=function(t){var i;return i=new Array,this.each(function(){var n;return n=e(this).closest(".bdwm-dialog-wrapper"),n&&n.length?i.push(n.data("dialog")):i.push(new BDWM.Dialog(e(this),t))}),i.length?i[0]:null},BDWM.init)return BDWM.init("",function(){return e("body").css({overflow:""}),e(".bdwm-dialog").each(function(){var t,i,n,a,r;if(!e(this).data("dialog-initialized"))return t={},t.animateIn=null==(i=e(this).data("animate-in"))||i,t.animateOut=null==(n=e(this).data("animate-out"))||n,t.background=null==(a=e(this).data("background"))||a,t.timeout=null!=(r=e(this).data("timeout"))?r:0,e(this).bdwm_dialog(t)}),e('.bdwm-dialog-wrapper[data-bdwm-dialog-auto-delete-when-pjax="true"]').remove()})}(jQuery);var QEDITOR_ALLOW_CLASSNAMES_ON_PASTE,QEDITOR_ALLOW_TAGS_ON_PASTE,QEDITOR_ASCIIART_PREVIEW_HTML,QEDITOR_BACKGROUND_COLORS,QEDITOR_COLORS,QEDITOR_DISABLE_ATTRIBUTES_ON_PASTE,QEDITOR_NEW_LINE_WRAPPER,QEDITOR_TOOLBAR_HTML,indexOf=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};window.BDWM||(window.BDWM={}),QEDITOR_TOOLBAR_HTML='<div class="qeditor_toolbar" style="display: block">\n  <a href="#" data-action="bold" class="qe-bold"><span class="fa fa-bold" title="加粗"></span></a>\n  <a href="#" data-action="underline" class="qe-underline"><span class="fa fa-underline" title="下划线"></span></a>\n  <span class="vline"></span>\n  <span class="qe-icon qe-color">\n    <ul class="qe-block-menu">\n      <li class="qe-c-default"><a href="#" data-name="rgb(51, 51, 51)" data-color="#333333" class="cover"><a href="#" class="qe-c1"></a></a><span>默认颜色</span></li>\n      <li><a href="#" data-name="rgb(0, 0, 0)" data-color="#000000" class="qe-c1"></a></li>\n      <li><a href="#" data-name="rgb(192, 0, 0)"  data-color="#c00000" class="qe-c2"></a></li>\n      <li><a href="#" data-name="rgb(0, 192, 0)"  data-color="#00c000" class="qe-c3"></a></li>\n      <li><a href="#" data-name="rgb(192, 192, 0)"  data-color="#c0c000" class="qe-c4"></a></li>\n      <li><a href="#" data-name="rgb(0, 0, 192)" data-color="#0000c0" class="qe-c5"></a></li>\n      <li><a href="#" data-name="rgb(192, 0, 192)" data-color="#c000c0" class="qe-c6"></a></li>\n      <li><a href="#" data-name="rgb(0, 192, 192)" data-color="#00c0c0" class="qe-c7"></a></li>\n      <li><a href="#" data-name="rgb(192, 192, 192)" data-color="#c0c0c0" class="qe-c8"></a></li>\n    </ul>\n    <a href="#" class="icon fa fa-font" title="字体颜色" data-no-pjax></a>\n  </span>\n  <span class="qe-icon qe-background-color">\n    <ul class="qe-block-menu">\n      <li class="qe-c-default"><a href="#" data-name="rgb(255, 255, 255)" data-color="#ffffff" class="cover"></a><a href="#" class="qe-bc8"></a><span>默认颜色</span></li>\n      <li><a href="#" data-name="rgb(64, 64, 64)" data-color="#404040" class="qe-bc1"></a></li>\n      <li><a href="#" data-name="rgb(255, 64, 64)"  data-color="#ff4040" class="qe-bc2"></a></li>\n      <li><a href="#" data-name="rgb(64, 255, 64)"  data-color="#40ff40" class="qe-bc3"></a></li>\n      <li><a href="#" data-name="rgb(255, 255, 64)"  data-color="#ffff40" class="qe-bc4"></a></li>\n      <li><a href="#" data-name="rgb(64, 64, 255)" data-color="#4040ff" class="qe-bc5"></a></li>\n      <li><a href="#" data-name="rgb(255, 64, 255)" data-color="#ff40ff" class="qe-bc6"></a></li>\n      <li><a href="#" data-name="rgb(64, 255, 255)" data-color="#40ffff" class="qe-bc7"></a></li>\n      <li><a href="#" data-name="rgb(254, 254, 254)" data-color="#fefefe" class="qe-bc8"></a></li>\n    </ul>\n    <a href="#" class="icon fa fa-font" title="背景颜色" data-no-pjax></a>\n  </span>\n  <span class="vline"></span>\n  <a href="#" data-action="blockquote" class="qe-blockquote"><span class="fa fa-quote-left" title="引用"></span></a>\n  <a href="#" data-action="code" class="qe-code"><span class="fa fa-code" title="代码"></span></a>\n  <a href="#" data-action="tex" class="qe-tex"><span class="fa fa-tex" title="TEX"></span></a>\n  <a href="#" data-action="math" class="qe-math"><span class="fa fa-math" title="数学公式"></span></a>\n  <a href="#" data-action="insertimage" class="qe-image"><span class="fa fa-picture-o" title="插入图片"></span></a>\n  <a href="#" data-action="fullScreen" class="qe-fullscreen pull-right"><span class="fa fa-arrows-alt" title="全屏编写"></span></a>\n  <a href="#" data-action="asciiart" class="qe-asciiart big-btn pull-right"><span class="fa" title="AsciiArt预览">&lt;ASCII&gt;</span></a>\n</div>',QEDITOR_ASCIIART_PREVIEW_HTML='<div id="ascii-preview" class="bdwm-ascii-preview-dialog bdwm-dialog">\n  <div class=\'bdwm-ascii-preview-content-wrapper file-read pre\'>\n  </div>\n  <a class="bdwm-ascii-preview-dialog-dismiss" data-action="dialog-dismiss"></a>\n</div>',QEDITOR_ALLOW_TAGS_ON_PASTE="div,p,b,u,strong,img,blockquote,pre,font,code,span",QEDITOR_DISABLE_ATTRIBUTES_ON_PASTE=["style","id","name"],QEDITOR_ALLOW_CLASSNAMES_ON_PASTE=["pre","quotehead","blockquote","p","rangySelectionBoundary"],QEDITOR_NEW_LINE_WRAPPER=["p","div","pre","blockquote","br","code"],QEDITOR_COLORS=[{no:0,color:"#000000"},{no:1,color:"#c00000"},{no:2,color:"#00c000"},{no:3,color:"#c0c000"},{no:4,color:"#0000c0"},{no:5,color:"#c000c0"},{no:6,color:"#00c0c0"},{no:7,color:"#c0c0c0"},{no:9,color:"#333333"}],QEDITOR_BACKGROUND_COLORS=[{no:0,color:"rgb(64, 64, 64)"},{no:1,color:"rgb(255, 64, 64)"},{no:2,color:"rgb(64, 255, 64)"},{no:3,color:"rgb(255, 255, 64)"},{no:4,color:"rgb(64, 64, 255)"},{no:5,color:"rgb(255, 64, 255)"},{no:6,color:"rgb(64, 255, 255)"},{no:7,color:"rgb(254, 254, 254)"},{no:9,color:"rgb(255, 255, 255)"}],window.BDWM.defaultStyle={type:"ansi",bold:!1,underline:!1,fore_color:9,back_color:9},window.BDWM.parser=function(e){var t,i,n,a,r,o,s;return t=["type","bold","underline","fore_color","back_color"],i=$.extend(!0,{},window.BDWM.defaultStyle),o=[],a=function(){return o.length?o[o.length-1]:null},n=function(e){var t;return t="",e&&(t=$(e).prop("tagName").toLowerCase()),"p"===t&&$(e).attr("class")&&(t=$(e).attr("class").toString().toLowerCase()),t},r=function(e){var i;return i=a(),e.content&&(e.content=e.content.replace(/(\u00A0|\uA1A1)/g," ")),i&&e&&"img"!==e.type&&"img"!==i&&!_.find(t,function(t){return e[t]!==i[t]})?void(i.content+=e.content):void o.push(e)},s=function(e,t,o){var d,c,l,h;return null==o&&(o=!1),h=$.extend(!0,{},i,t),l=n($(e)[0]),c=indexOf.call(QEDITOR_NEW_LINE_WRAPPER,l)>=0,d=!0,$(e).contents().each(function(){var e,t,i,l,p,m;return!o&&c&&(l=a(),!l||"ansi"!==(p=l.type)&&"code"!==p&&"quote"!==p?r($.extend(!0,{},h,{content:"\n"})):l.content+="\n",c=!1),3===this.nodeType&&r($.extend(!0,{},h,{content:$(this).text()})),1===this.nodeType&&("br"===n(this)?(c=!0,o=!1):"img"===n(this)?r($.extend(!0,{},h,{src:$(this).prop("src"),type:"img"})):"blockquote"===n(this)?($(this).text($(this).text()),s($(this),$.extend(!0,{},h,{type:"quote"}),d)):"quotehead"===n(this)?(l=a(),!l||"ansi"!==(m=l.type)&&"code"!==m&&"quote"!==m||(l.content+="\n"),r({type:"quotehead",username:$(this).data("username").toString(),nickname:$(this).data("nickname").toString(),mail:!!$(this).data("mail")}),d=!0):"code"===n(this)?($(this).text($(this).text()),s($(this),$.extend(!0,{},{type:"code",lang:"text"}),d)):"font"===n(this)?(e=$(this).prop("color"),e?(i=_.find(QEDITOR_COLORS,function(t){return t.color===e}),t=i?i.no:9):t=9,s($(this),$.extend(!0,{},h,9===t?{}:{fore_color:t}),d)):"span"===n(this)?(e=$(this).css("background-color"),e?(i=_.find(QEDITOR_BACKGROUND_COLORS,function(t){return t.color===e}),t=i?i.no:9):t=9,s($(this),$.extend(!0,{},h,9===t?{}:{back_color:t}),d)):"b"===n(this)?s($(this),$.extend(!0,{},h,{bold:!0}),d):"u"===n(this)?s($(this),$.extend(!0,{},h,{underline:!0}),d):s($(this),$.extend(!0,{},h,{}),d)),1===this.nodeType&&"quotehead"===n(this)||(d=!1),!0})},s($(e).clone(),{},!0),o},window.BDWM.QEditor=function(){function e(e){this.textarea=e,this.init()}return e.prototype.actions=["bold","underline","insertunorderedlist","insertorderedlist","blockquote","code"],e.prototype.init=function(){var e,t,i,n,a,r,o,s;return o=this,i=$(this.textarea),i.addClass("qeditor"),t=$('<div class="qeditor_preview clearfix" contentEditable="true" style="display: block"></div>'),n=$("<p><br></p>"),t.css({width:i.width()-25}),r=i.attr("tabindex"),t.attr("tabindex",r),i.attr("tabindex","-1"),$(document).keyup(function(e){if(27===e.keyCode)return o.exitFullScreen()}),document.execCommand("defaultParagraphSeparator",!1,"p"),e=i.val(),t.html(e),t.addClass(i.attr("class")),i.after(t),n.text(i.attr("placeholder")),t.attr("placeholder",i.attr("placeholder")||""),t.append(n),t.focusin(function(){if(o.checkSectionState(),n=$(this).find(".qeditor_placeholder"),n&&n.length)return n.remove(),$(this).html("<p><br></p>"),$(this).focus()}),t.blur(function(){return o.checkSectionState()}),t.change(function(){var e,i,n,a;return n=t,a=n.parent().find(".qeditor"),a.val(n.html()),i=rangy.saveSelection(),e=function(t){var i,a;return a=$(t).contents().length-$(t).children(".rangySelectionBoundary").length,i=0,$(t).contents().each(function(r){var o,s,d;if($(this).hasClass(".rangySelectionBoundary")||i++,!o&&1===this.nodeType)if(d=$(this).prop("tagName").toLowerCase(),"br"===d&&1!==a){if(1!==i&&r!==$(t).contents().length-1&&(s=rangy.createRange(),s.selectNode(this),rangy.getSelection().setSingleRange(s),document.execCommand("InsertParagraph",!1),o=!0),$(this).remove(),o)return e(n)}else if(!$(this).hasClass(".rangySelectionBoundary"))return e(this)})},$(n).contents().each(function(){if(3===this.nodeType&&0!==$(this).text().replace(/\n/g,"").length||1===this.nodeType&&"br"===$(this).prop("tagName").toLowerCase())return $(this).wrap("<p></p>")}),$(n).children(".quotehead").each(function(){return 0===$(this).text().length?$(this).removeClass("quotehead").addClass("blockquote").removeAttr("data-username").removeAttr("data-nickname"):$(this).attr("contenteditable","false")}),e(n),$(n).children("p").each(function(){if($(this).contents().length-$(this).children(".rangySelectionBoundary").length===0)return $(this).append("<br>")}),rangy.restoreSelection(i),n.fixEmpty()}),t.on("paste",function(){var e;return e=$(this),setTimeout(function(){var t,i,n,a;for(e.find("p.code").each(function(){var e,t;return $(this).find("*").removeAttr("style").each(function(){if(!$(this).hasClass("rangySelectionBoundary"))return $(this).removeAttr("class")}),t=$("<p></p>").text('<code lang="'+$(this).data("lang")+'">'),e=$("<p></p>").text("</code>"),$(this).before(t).after(e),$(this).removeAttr("style data-lang")}),i=e.find("*"),i.removeClass(function(e,t){if(!(indexOf.call(QEDITOR_ALLOW_CLASSNAMES_ON_PASTE,t)>=0))return $(this).removeClass(t)}),i.each(function(){if("rgb(0, 0, 0)"!==$(this).css("background-color")&&"rgba(0, 0, 0, 0)"!==$(this).css("background-color"))return $(this).attr("data-back-color",$(this).css("background-color"))}),n=0,a=QEDITOR_DISABLE_ATTRIBUTES_ON_PASTE.length;n<a;n++)t=QEDITOR_DISABLE_ATTRIBUTES_ON_PASTE[n],i.removeAttr(t);return i.find("script,style,link").remove(),i.find(":not("+QEDITOR_ALLOW_TAGS_ON_PASTE+")").contents().unwrap(),e.find("*").each(function(){if($(this).attr("data-back-color"))return $(this).css({background:$(this).attr("data-back-color")}),$(this).removeAttr("data-back-color")}),e.change(),!0},100)}),t.keyup(function(e){var n;return n=e.keyCode||e.which,e.shiftKey||e.ctrlKey||e.altKey||108!==n&&13!==n||(i=$(this),setTimeout(function(){return i.change()},0)),o.checkSectionState(t),!0}),t.keydown(function(e){var t,n;return 13===e.keyCode&&(e.metaKey||e.ctrlKey)?(i.trigger("send"),!1):8!==e.keyCode||(n=rangy.getSelection(),t=!1,$(this).find(".quotehead").each(function(){var e;if(e=$(this),e.next().length&&n.isCollapsed&&n.containsNode(e.next().eq(0).get(0),!0)&&0===n.anchorOffset)return e.remove(),t=!0}),!t)}),t.on("mouseup",function(e){return o.checkSectionState(t),e.stopPropagation()}),t.fixEmpty=function(){var e,t;if(o.isEmpty())return $(this).html("<p><br></p>"),t=rangy.getSelection(),e=rangy.createRange(),e.collapseToPoint($(this).children().eq(0).get(0),0),t.setSingleRange(e)},i.hide(),i.wrap('<div class="qeditor_border" style="display: block; text-align: left;"></div>'),i.after(t),this.border=i.closest(".qeditor_border"),s=$(QEDITOR_TOOLBAR_HTML),a=s.find(".qe-color,.qe-background-color"),a.mouseenter(function(){return $(this).addClass("hover"),$(this).find(".qe-block-menu").show()}),a.mouseleave(function(){return $(this).removeClass("hover"),$(this).find(".qe-block-menu").hide()}),s.find(".qe-color .qe-block-menu li").click(function(e){var t;return e.stopPropagation(),t=$(this).children("a"),t.parent().parent().hide(),o.action(this,"ForeColor",t.data("color")),o.checkSectionState(),!1}),s.find(".qe-background-color .qe-block-menu li").click(function(e){var t;return e.stopPropagation(),t=$(this).children("a"),t.parent().parent().hide(),o.action(this,"BackColor",t.data("color")),o.checkSectionState(),!1}),s.find("a[data-action]").click(function(e){return e.preventDefault(),o.action(this,$(this).attr("data-action")),o.checkSectionState(),!1}),s.find(".qe-color >a,.qe-background-color >a").click(function(e){return e.preventDefault(),!1}),t.before(s),this.editor=t,this.toolbar=s},e.prototype.action=function(e,t,i){var n;if(this.editor.find(".qeditor_placeholder").remove(),this.editor.focus(),null===i&&(i=!1),"blockquote"===t&&(i=t,t="formatBlock"),"fullScreen"===t)return this.toggleFullScreen();if("createLink"===t){if(i=prompt("Type URL:"),0===i.trim().length)return!1}else if("insertimage"===t){if(i=prompt("如需插入本地图片，请点击编辑器下方“管理附件”按钮上传；\n如需插入线上（外链）图片，请在此输入该图片的网址:"),0===i.trim().length)return!1;if(i.match(/^data:image\/(jpeg|jpg|png|gif);base64,/))return BDWM.alert("请不要使用base64编码插入图片"),!1}else{if("formatBlock"===t)return this.formatBlock(i),!1;if("asciiart"===t)return 0===$("#ascii-preview").length&&$("#page-content").append(QEDITOR_ASCIIART_PREVIEW_HTML),n=function(e,t,i){return $(e).contents().each(function(){return 3===this.nodeType?this.nodeValue=this.nodeValue.replace(new RegExp(t,"g"),i):n(this,t,i)})},n($("#ascii-preview .file-read").html(this.editor.html()),"\\s"," "),$("#ascii-preview").bdwm_dialog().show(),!1;if("code"===t)return i=prompt("请输入代码类型:"),0!==i.trim().length&&(this.insertCodeTag(i),!1);if("tex"===t||"math"===t)return this.insertCodeTag(t),!1}return this.state(t)?document.execCommand(t,!1,null):document.execCommand(t,!1,i),this.checkSectionState(),!1},e.prototype.formatBlock=function(e){var t,i,n,a;return a=this,n=rangy.getSelection(),i=rangy.saveSelection(),t=this.getCurrentAllFirstChildBlockNodeName(),this.editor.children().each(function(){if(n.containsNode(this,!0))return t===e?a.changeBlockTagName(this,"p"):a.changeBlockTagName(this,e)}),rangy.restoreSelection(i),this.checkSectionState(),this.editor.change()},e.prototype.insertCodeTag=function(e){var t,i,n,a,r;return"tex"===e?(i="<tex></tex>",a=5):"math"===e?(i="<math></math>",a=6):(i='<code lang="'+e+'"></code>',a=14+e.length),r=rangy.getSelection(),r.isCollapsed||document.execCommand("delete",!1),n=$(this.getCurrentFirstChildBlockNode()),0===n.length&&(n=this.editor.children(">p:last-child")),0===n.length&&(n=$("<p></p>").appendTo(this.editor)),0===n.text().length?n.html("").removeAttr("class"):(t=$("<p></p>"),n.after(t),n=t),n.text(i),r=rangy.getSelection(),r.collapse(n.contents().get(0),a)},e.prototype.state=function(e){return document.queryCommandState(e)===!0},e.prototype.value=function(e){return document.queryCommandValue(e)},e.prototype.prompt=function(e){var t;return t=prompt(e),!!t&&t},e.prototype.toggleFullScreen=function(){return"1"===this.border.data("qe-fullscreen")?this.exitFullScreen():this.enterFullScreen(),!1},e.prototype.enterFullScreen=function(){return this.border.data("qe-fullscreen","1").addClass("qeditor_fullscreen"),this.border.find(".qeditor_preview").focus(),this.border.find(".qe-fullscreen span").attr("class","fa fa-compress")},e.prototype.exitFullScreen=function(){return this.border.removeClass("qeditor_fullscreen").data("qe-fullscreen","0").find(".qe-fullscreen span").attr("class","fa fa-arrows-alt")},e.prototype.getCurrentFirstChildBlockNode=function(){var e,t;return t=rangy.getSelection(),e=null,this.editor.children().each(function(){if(t.containsNode(this,!0))return e=this,!1}),e},e.prototype.getCurrentAllFirstChildBlockNodeName=function(){var e,t,i,n;return n=this,t=rangy.getSelection(),i="",e=!0,this.editor.children().each(function(){var a;if(t.containsNode(this,!0))return a=n.getContainerBlockNodeName(this),a!==i&&""!==i?e=!1:i=a}),e||(i=""),i.toLowerCase()},e.prototype.getBlockName=function(e){var t;return t="",e&&(t=$(e).prop("tagName").toLowerCase()),"p"===t&&$(e).attr("class")&&(t=$(e).attr("class").toString().toLowerCase()),t},e.prototype.getContainerBlockNode=function(e){return e&&(e=$(e).closest("p,div,blockquote,pre,code")),e},e.prototype.getContainerBlockNodeName=function(e){return e=this.getContainerBlockNode(e),this.getBlockName(e)},e.prototype.getCurrentContainerBlockNode=function(){var e;return e=this.getCurrentContainerNode(),this.getContainerBlockNode(e)},e.prototype.getCurrentContainerBlockNodeName=function(){var e,t;return e=this.getCurrentContainerBlockNode(),t=this.getBlockName(e)},e.prototype.getCurrentContainerNode=function(){var e,t;return(t=rangy.getSelection().anchorNode)?e=3===t.nodeType?t.parentNode:t:null},e.prototype.getCurrentContainerNodeName=function(){var e,t;return e=this.getCurrentContainerNode(),t=this.getBlockName(e)},e.prototype.changeBlockTagName=function(e,t){var i,n;if(!$(e).hasClass(t)&&this.getBlockName(e)!==t)return $(e).hasClass("quotehead")&&($(e).text($(e).text()),n=rangy.getSelection(),i=rangy.createRange(),i.collapseToPoint($(e).get(0),$(e).text().length),n.setSingleRange(i)),$(e).removeClass("p blockquote pre code quotehead"),$(e).addClass(t),e},e.prototype.checkSectionState=function(){var e,t,i,n,a,r;for(r=this.actions,i=0,n=r.length;i<n;i++)e=r[i],a=this.toolbar.find("a[data-action="+e+"]"),this.state(e)||this.getCurrentAllFirstChildBlockNodeName()===e?a.addClass("qe-state-on"):a.removeClass("qe-state-on");return this.editor.parent().find(".qeditor_toolbar .qe-color li").removeClass("active"),t=this.editor.parent().find(".qeditor_toolbar .qe-color a[data-name='"+this.value("ForeColor")+"']").parent(),t&&0!==t.length||(t=this.editor.parent().find(".qeditor_toolbar .qe-color .qe-c-default")),t.addClass("active"),this.editor.parent().find(".qeditor_toolbar .qe-background-color li").removeClass("active"),t=this.editor.parent().find(".qeditor_toolbar .qe-background-color a[data-name='"+this.value("BackColor")+"']").parent(),t&&0!==t.length||(t=this.editor.parent().find(".qeditor_toolbar .qe-background-color .qe-c-default")),t.addClass("active"),this.editor.hasClass("pre")?this.editor.parent().find(".qeditor_toolbar .qe-asciiart").addClass("qe-state-on"):this.editor.parent().find(".qeditor_toolbar .qe-asciiart").removeClass("qe-state-on")},e.prototype.isEmpty=function(){var e;return e=this.editor.html().toLowerCase(),""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.editor.children(".qeditor_placeholder").length>0},e.prototype.toStruct=function(e){return null==e&&(e=this.editor),BDWM.parser(e)},e.prototype.lineCount=function(){return this.editor.children("p").length},e.prototype.getText=function(){return this.editor.text()},e.prototype.inject=function(e){return $(this.editor).html(e)},e.prototype.injectObject=function(e){return $(this.editor).children().remove(),$(this.editor).append($(e).children().clone())},e.prototype.version=function(){return"0.4.0"},e}(),function(e){if(e.fn.bdwm_editor=function(t){var i;return i=[],this.each(function(){var t;return e(this).data("init")&&e(this).parent(".qeditor_border").length&&(e(this).siblings().remove(),e(this).unwrap(),e(this).css({display:""})),t=new BDWM.QEditor(this),e(this).attr("data-init",!0),i.push(t)}),i},BDWM.init)return BDWM.init("",function(){return e(".bdwm-editor,#bdwm-editor").find("select.cs-select").each(function(){return"signature"!==e(this).data("role")||e(this).data("signature-no-history")||BDWM.initQmd(this),BDWM.initSelect(this)}),e(".bdwm-editor .title-input input[maxlength],#bdwm-editor .title-input input[maxlength]").each(function(){if(BDWM.inputLimit(this,e(this).closest(".bdwm-editor, #bdwm-editor").find(".title-suggest"),e(this).closest(".bdwm-editor, #bdwm-editor").find(".publish-button")),e(this).val()&&e(this).val().length>0)return BDWM.inputLimitCut(e(this))})})}(jQuery);var FRIENDS_SELECTOR_HTML,indexOf=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};FRIENDS_SELECTOR_HTML="<div id=\"bdwm-friends-selector\">\n  <div class='bdwm-friends-selector-content'>\n    <div class='bdwm-friends-selector-half'>\n      <div class='bdwm-friends-selector-subtitle'>我的好友</div>\n      <div class='bdwm-friends-selector-half-content'>\n        <div class='bdwm-friends-selector-input-wrapper'>\n          <input class='bdwm-friends-selector-input' placeholder='搜索好友' maxlength=\"12\">\n          <img src=\"images/home/iconfont-sousuo.png\">\n        </div>\n        <div class='bdwm-friends-selector-list'>\n          <ul class='bdwm-custom-scroll-bar' data-role='friends-list-for-select'>\n          </ul>\n        </div>\n        <div class='bdwm-friends-selector-loading-mask'><img src='images/global/iconfont-loading.png'></div>\n      </div>\n    </div>\n    <div class='bdwm-friends-selector-half'>\n      <div class='bdwm-friends-selector-subtitle'>已选</div>\n      <div class='bdwm-friends-selector-half-content'>\n        <div class='bdwm-friends-selector-list'>\n          <ul class='bdwm-custom-scroll-bar' data-role=\"friends-list-selected\">\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='bdwm-friends-selector-foot'>\n    <a class='bdwm-friends-selector-button'>添加</a>\n  </div>\n  <a class='bdwm-friends-selector-dismiss' data-action='dialog-dismiss'>\n    <img src='images/mail/iconfont-qingchu-1.png'>\n  </a>\n</div>",window.BDWM||(window.BDWM={}),window.BDWM.FriendSelector=function(){function e(e){var t;this.options=null!=e?e:{},"undefined"==typeof this.options.animateIn&&(this.options.animateIn=!0),"undefined"==typeof this.options.animateOut&&(this.options.animateOut=!0),"undefined"==typeof this.options.background&&(this.options.background=!0),this.options.timeout=0,this.main=$(FRIENDS_SELECTOR_HTML),$("#page-content").append(this.main),
    this.dialog=this.main.bdwm_dialog(this.options),this.shown=!1,this._data=[],this._reserved=[],this._originSelected=[],this._loading=!0,this.main.find(".bdwm-friends-selector-input").on("input propertychange",function(){return this.search(this.main.find(".bdwm-friends-selector-input").val())}.bind(this)),this.main.find(".bdwm-friends-selector-button").click(function(){return this._submit&&"[object Function]"===Object.prototype.toString.call(this._submit)&&this._submit(this.selected(),this._reserved),this.hide()}.bind(this)),t=function(){if(this._loading)return this.main.find(".bdwm-friends-selector-loading-mask >img").animate({rotate:"+=180"},1200,"linear",t.bind(this))},t.call(this)}return e.prototype.beforeShow=function(e){return this._beforeShow=e,this},e.prototype.show=function(){return this._beforeShow&&"[object Function]"===Object.prototype.toString.call(this._beforeShow)&&this._beforeShow(),this.dialog.show(),this.shown=!0,this},e.prototype.hide=function(){return this.dialog.hide(),this.shown=!1,this},e.prototype.trigger=function(e){var t;return t=this,$(e).click(function(){return this.shown?t.hide():t.show()}),this},e.prototype.data=function(e){var t,i;return e?(t=this.main.find('[data-role="friends-list-for-select"]'),i=this.main.find('[data-role="friends-list-selected"]'),t.children().remove(),i.children().remove(),_.each(e,function(e){var i,n;if(e.uid&&e.name)return n=Math.floor(1e4*Math.random()),i=$('<li data-friend-id="'+e.uid+'" ><input id="bdwm-friends-selector-list-'+n+"-"+e.uid+'" type="checkbox"><label for="bdwm-friends-selector-list-'+n+"-"+e.uid+'">'+e.name+"</label></li>"),i.data("object-bind",e),t.append(i),i.find("input").change(function(){return this.selectClickOnOne.bind(this).call(null,i)}.bind(this))}.bind(this)),this._data=e,this.selected(this._originSelected),this._loading=!1,this.main.find(".bdwm-friends-selector-loading-mask").hide(),this):this._data},e.prototype.selectClickOnOne=function(e){var t,i,n;return t=e.data("object-bind"),n=this.main.find('[data-role="friends-list-selected"]'),e.find("input").prop("checked")?(t.selected=!0,i=$('<li data-friend-id="'+t.uid+'" >'+t.name+'<a data-action="bdwm-friends-selector-friend-dismiss"></a></li>'),n.append(i),i.find('[data-action="bdwm-friends-selector-friend-dismiss"]').click(function(){return t.selected=!1,i.remove(),e.find("input").prop("checked",!1)})):(t.selected=!1,n.find("[data-friend-id="+t.uid+"]").remove())},e.prototype.selected=function(e){var t,i,n;return e?(t=this.main.find('[data-role="friends-list-for-select"]'),n=this.main.find('[data-role="friends-list-selected"]'),n.children().remove(),t.children().find("input").prop("checked",!1),i=_.filter(this._data,function(t){var i;return t.selected=(i=t.name,indexOf.call(e,i)>=0),t.selected}),this._reserved=_.difference(e,_.pluck(this._data,"name")),this._originSelected=e,_.each(i,function(e){var i;return i=t.find('[data-friend-id="'+e.uid+'"]'),i.find("input").prop("checked",!0),this.selectClickOnOne.bind(this).call(null,i)}.bind(this)),this):_.filter(this._data,function(e){return e.selected===!0})},e.prototype.search=function(e){var t;return e&&0!==e.length?(t=_.filter(this._data,function(t){return t.name.toLowerCase().indexOf(e.toLowerCase())>=0}),this.main.find('[data-role="friends-list-for-select"]').children().hide(),_.each(t,function(e){return this.main.find('[data-role="friends-list-for-select"]').find("[data-friend-id="+e.uid+"]").show()}.bind(this)),this):(this.main.find('[data-role="friends-list-for-select"]').children().show(),this)},e.prototype.submit=function(e){return this._submit=e,this},e}();var FILE_UPLOADER_HTML,FILE_UPLOADER_INPUT_HTML,FILE_UPLOADER_ITEM_FAILED_HTML,FILE_UPLOADER_ITEM_FINISHED_HTML,FILE_UPLOADER_ITEM_LOADING_HTML,_AjaxFileUpload_id,createForm,createIframe,doFileUpload,randomId;FILE_UPLOADER_HTML="<div id=\"bdwm-file-uploader\">\n  <div class='bdwm-file-uploader-content'>\n    <span class='bdwm-file-uploader-title'>管理附件</span>\n    <span class='bdwm-file-uploader-instruction'>点击『选取文件』选择需要上传的文件，点击『确认』完成上传。</span>\n    <div class='row'><a class='bdwm-file-uploader-open-file-button' data-action='bdwm-file-uploader-open-file'>选取文件</a></div>\n    <span class='bdwm-file-uploader-subtitle'>管理附件</span>\n    <ul class='bdwm-file-uploader-file-list bdwm-custom-scroll-bar' data-role='filelist'>\n    </ul>\n    <div class='row' style='text-align: center'><a class='bdwm-file-uploader-submit-button' data-action='bdwm-file-uploader-submit'>确认</a></div>\n  </div>\n  <a class='bdwm-file-uploader-dismiss' data-action='dialog-dismiss'>\n    <img src='images/mail/iconfont-qingchu-1.png'>\n  </a>\n</div>",FILE_UPLOADER_INPUT_HTML="<input type='file' name='file' data-role='bdwm-file-uploader-input' style='display: none'>",FILE_UPLOADER_ITEM_LOADING_HTML="<li><span data-role='filename'></span><a data-action='bdwm-file-uploader-remove-file'><img src='images/global/iconfont-loading.png'></a></li>",FILE_UPLOADER_ITEM_FINISHED_HTML="<li><span data-role='filename'></span><a data-action='bdwm-file-uploader-remove-file'><img src='images/global/iconfont-delete.png'></a></li>",FILE_UPLOADER_ITEM_FAILED_HTML="<li><span data-role='filename'></span><a data-action='bdwm-file-uploader-remove-file'>失败</a></li>",window.BDWM||(window.BDWM={}),_AjaxFileUpload_id=0,randomId=function(){return"_AjaxFileUpload_"+_AjaxFileUpload_id++},createIframe=function(){var e;return e=randomId(),$("#page-content").append('<iframe src="javascript:false;" name="'+e+'" id="'+e+'" style="display: none;"></iframe>'),$("#"+e)},createForm=function(e,t){return $("<form />").attr({method:"post",action:t,enctype:"multipart/form-data",target:e[0].name}).hide().appendTo("body")},doFileUpload=function(e,t,i,n,a,r){var o,s,d,c,l,h,p,m,u,f;if(o=$(e),0!==o.val().length){for(l=o.val().replace(/.*(\/|\\)/,""),d=createIframe(),s=createForm(d,t),p=d.attr("id"),o.remove(),c=i.split("&"),h=0,u=c.length;h<u;h++)f=c[h],m=f.split("="),m.length>=2&&$("<input />").attr("type","hidden").attr("name",m[0]).val(m[1]).appendTo(s);return o.appendTo(s),d.bind("load",{element:o,form:s,filename:l,id:p},function(e){var t,i,n;t=$(e.target);try{i=(t[0].contentWindow||t[0].contentDocument).document,n=n=i.body.innerText,n=n?$.parseJSON(n):{success:!1}}catch(a){n={success:!1}}return r.call(e.data.element,e.data.id,e.data.filename,n),e.data.form.remove(),t.remove()}),s.bind("submit",{element:o,filename:l,id:p},function(e){var t;return t=n.call(e.data.element,e.data.id,e.data.filename),t!==!1&&(a.call(e.data.element,e.data.id,e.data.filename),!0)}).submit()}},window.BDWM.file_upload=doFileUpload,window.BDWM.FileUploader=function(){function e(e){var t,i,n,a,r,o;this.options=null!=e?e:{},o=this,"undefined"==typeof this.options.animateIn&&(this.options.animateIn=!0),"undefined"==typeof this.options.animateOut&&(this.options.animateOut=!0),"undefined"==typeof this.options.background&&(this.options.background=!0),this.options.timeout=0,this.main=$(FILE_UPLOADER_HTML),$("#page-content").append(this.main),this.dialog=this.main.bdwm_dialog(this.options),this.shown=!1,this._data=[],this._reserved=[],this.loading=0,n=this.main,i=this.options.dir||"",t=this.options.action||"",a=this.options.onSubmit||function(e,t){},this.onComplete=this.options.onComplete||function(e,t,i){},r=this,this.main.find('[data-action="bdwm-file-uploader-open-file"]').click(function(){var e;return e=$(FILE_UPLOADER_INPUT_HTML),n.append(e),e.change(function(){return BDWM.file_upload($(this),t,"dir="+i,a,o.addLoading.bind(o),o.addFinished.bind(o))}),e.click()}),this.main.find('[data-action="bdwm-file-uploader-submit"]').click(function(){if(0===this.loading)return this.hide()}.bind(this))}return e.prototype.beforeShow=function(e){return this._beforeShow=e,this},e.prototype.show=function(){return this._beforeShow&&"[object Function]"===Object.prototype.toString.call(this._beforeShow)&&this._beforeShow(),this.dialog.show(),this.shown=!0,this},e.prototype.hide=function(){return this.dialog.hide(),this.shown=!1,this},e.prototype.trigger=function(e){var t;return t=this,$(e).click(function(){return this.shown?t.hide():t.show()}),this},e.prototype.submit=function(e){return this._submit=e,this},e.prototype.addLoading=function(e,t){var i,n;return this.loading++,i=$(FILE_UPLOADER_ITEM_LOADING_HTML),this.main.find("#_file_"+e).remove(),i.attr("id","_file_"+e),i.find('[data-role="filename"]').text(t),i.appendTo(this.main.find('[data-role="filelist"]')),(n=function(e){return e.animate({rotate:"+=180"},1200,"linear",function(){return n(e)})})(i.find('[data-action="bdwm-file-uploader-remove-file"] img'))},e.prototype.addFinished=function(e,t,i){var n;return i.success?(n=i.name,this.loading--,this.insertFileListItem(e,n,t)):this.insertFileListFailedItem(e,n,t),this.onComplete.call(this,e,t,i)},e.prototype.insertFileListItem=function(e,t,i){var n,a,r,o,s;return s=function(e,t,i,n){return $.ajax({type:"post",url:t,data:"action=delete&dir="+i+"&name="+n,dataType:"json",timeout:4e3}).done(function(t){if(t.success)return e.remove()}),!0},n=$(FILE_UPLOADER_ITEM_FINISHED_HTML),e&&""!==e||(e=randomId()),o=this.main.find("#_file_"+e).removeAttr("id"),n.attr("id","_file_"+e),n.find('[data-role="filename"]').text(i),o&&o.length?o.before(n).remove():n.appendTo(this.main.find('[data-role="filelist"]')),r=this.options.dir||"",a=this.options.action||"",n.find('[data-action="bdwm-file-uploader-remove-file"]').data("filename",t).click(function(){return s(n,a,r,t)})},e.prototype.insertFileListFailedItem=function(e,t,i){var n,a;return n=$(FILE_UPLOADER_ITEM_FAILED_HTML),e&&""!==e||(e=randomId()),a=this.main.find("#_file_"+e).removeAttr("id"),n.attr("id","_file_"+e),n.find('[data-role="filename"]').text(i),a&&a.length?a.before(n).remove():n.appendTo(this.main.find('[data-role="filelist"]')),n.find('[data-action="bdwm-file-uploader-remove-file"]').data("filename",t).click(function(){return n.remove()})},e}();var BDWM_DIALOG_OP_COLLECT,BDWM_DIALOG_OP_COLLECT_EXPLORER,BDWM_DIALOG_OP_COLLECT_EXPLORER_NEW_DIR,BDWM_DIALOG_OP_REPRINT,BDWM_DIALOG_OP_RESEND,BDWM_DIALOG_WITH_CLOSE_ICON_HTML,BDWM_OP_COLLECT_DOWNLIST,bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function i(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;window.BDWM||(window.BDWM={}),BDWM_DIALOG_WITH_CLOSE_ICON_HTML="<div class=\"bdwm-dialog-with-close-icon bdwm-dialog\">\n  <a class='close-icon'></a>\n  <div class='content'></div>\n</div>",window.BDWM.DialogWithCloseIcon=function(){function e(e){this.options=null!=e?e:{},"undefined"==typeof this.options.content&&(this.options.content=""),"undefined"==typeof this.options.animateIn&&(this.options.animateIn=!1),"undefined"==typeof this.options.animateOut&&(this.options.animateOut=!0),"undefined"==typeof this.options.background&&(this.options.background=!1),"undefined"==typeof this.options.timeout&&(this.options.timeout=0),this.options.autoDeleteWhenPjax=!0,"undefined"==typeof this.options.autoDeleteWhenClose&&(this.options.autoDeleteWhenClose=!0),"undefined"==typeof this.options.replaceTemplate&&(this.options.replaceTemplate=!1),this.options.replaceTemplate?this.element=this.options.content:(this.element=$(BDWM_DIALOG_WITH_CLOSE_ICON_HTML),this.element.find(".content").append(this.options.content)),$("#page-content").append(this.element),this.element.bdwm_dialog(this.options).show(),this.options.autoDeleteWhenClose&&this.element.find(".close-icon").click(this.hide.bind(this))}return e.prototype.hide=function(){return this.element.bdwm_dialog().hide(),setTimeout(function(){return this.element.closest(".bdwm-dialog-wrapper").remove()}.bind(this),2e3)},e}(),window.BDWM.dialogWithCloseIcon=function(e,t){return new BDWM.DialogWithCloseIcon(_.extend({content:e},t))},window.BDWM.UrlCopier=function(){function e(){var e,t,i;i=window.location.href,e=$('<input style="position: absulote; opacity:0;">'),e.val(i),$("#page-content").append(e),e[0].select(),e[0].setSelectionRange(0,e[0].value.length),t=document.execCommand("copy"),e.remove(),t?BDWM.dialogWithCloseIcon($("<span>当前页面地址已被放入剪切板</span>"),{timeout:3e3}):t||BDWM.alert({text:"抱歉, 您的浏览器不支持此功能"})}return e}(),window.BDWM.urlCopier=function(e){return e.click(function(e){return e.preventDefault(),new BDWM.UrlCopier})},BDWM_DIALOG_OP_REPRINT="<div class=\"bdwm-dialog-with-close-icon bdwm-op-reprint bdwm-dialog\">\n  <span class='close-icon'></span>\n  <div class='content'>\n    <div>\n      <span class='prompt'>转载到</span>\n      <input placeholder='版面英文名' id='ipt-board-name'>\n      <span class='bdwm-orange-btn' data-action='confirm'>确定</span>\n      <span class='error'>该版面不存在，或需要特殊权限</span>\n    </div>\n    <div class='notification'>\n      <h4>请注意：</h4>\n      <p>本站规定，相同或相近内容的帖子一周内严禁在5个及5个以上讨论区内重复张贴，否则将受到禁言全站发文权限直至删除帐号的处罚。<br>\n        多个id共同一文多发的，对参与多发的每个id按多发总数进行处罚</p>\n    </div>\n  </div>\n</div>",window.BDWM.OpReprint=function(){function e(e){var t;this.reqData=e,this.boardNotFound=bind(this.boardNotFound,this),this.confirmReprint=bind(this.confirmReprint,this),this.dialog=BDWM.dialogWithCloseIcon($(BDWM_DIALOG_OP_REPRINT),{replaceTemplate:!0}),this.$element=this.dialog.element,this.$error=this.$element.find(".error"),this.$error.hide(),t=this.$element.find("[data-action=confirm]"),t.click(this.confirmReprint),this.$element.find("#ipt-board-name").focus().keypress(function(e){if(13===e.which)return t.click()})}return e.prototype.confirmReprint=function(){var e;return e=this.$element.find("#ipt-board-name").val(),this.$error.hide(),$.ajax({type:"POST",url:"ajax/get_topsearch.php",data:{pref:e},dataType:"json",timeout:4e3}).done(function(t){return function(i){var n,a,r,o,s,d;if(i.success){for(o=i.boards,a=-1,r="",s=0,d=o.length;s<d;s++)n=o[s],e.toLowerCase()===n.name.toLowerCase()&&(a=n.id,r=n.name);return 1===o.length&&(a=o[0].id,r=o[0].name),a===-1?t.boardNotFound():t.sendRequest(a,r)}}}(this)).fail(this.error)},e.prototype.sendRequest=function(e,t){var i;return this.reqData.to="post",this.reqData.tobid=e,i="thread.php?bid="+e,$.ajax({type:"POST",url:"ajax/forward.php",data:this.reqData,dataType:"json"}).done(function(e){return function(n){return n.success?(BDWM.alert({html:'已将该帖转载到 <a href="'+i+'">'+t+"</a> 版面"}),e.hide()):9===n.error?BDWM.alert({text:"您没有足够权限执行此操作"}):e.error()}}(this)).fail(this.error)},e.prototype.boardNotFound=function(){return this.$error.show()},e.prototype.hide=function(){return this.dialog.hide()},e.prototype.error=function(){return BDWM.alert({text:"发生错误啦><"})},e}(),window.BDWM.opReprint=function(e,t){return e.click(function(e){return new BDWM.OpReprint(t),e.preventDefault()})},BDWM_DIALOG_OP_RESEND="<div class=\"bdwm-dialog-with-close-icon bdwm-op-resend bdwm-dialog\">\n  <span class='close-icon'></span>\n  <div class='content'>\n    <div>\n      <span class='prompt'>转寄给</span>\n      <input placeholder='用户ID' id='ipt-username'>\n      <span class='bdwm-orange-btn' data-action='confirm'>确定</span>\n      <span class='error'>用户不存在</span>\n    </div>\n  </div>\n</div>",window.BDWM.OpResend=function(){function e(e){var t;this.reqData=e,this.boardNotFound=bind(this.boardNotFound,this),this.confirmResend=bind(this.confirmResend,this),this.dialog=BDWM.dialogWithCloseIcon($(BDWM_DIALOG_OP_RESEND),{replaceTemplate:!0}),this.$element=this.dialog.element,this.$error=this.$element.find(".error"),this.$error.hide(),t=this.$element.find("[data-action=confirm]"),t.click(this.confirmResend),this.$element.find("#ipt-username").focus().keypress(function(e){if(13===e.which)return t.click()})}return e.prototype.confirmResend=function(){var e;return e=this.$element.find("#ipt-username").val(),this.$error.hide(),$.ajax({type:"POST",url:"ajax/get_topsearch.php",data:{pref:e},dataType:"json",timeout:4e3}).done(function(t){return function(i){var n,a,r,o,s;if(i.success){for(s=i.users,o=-1,n=0,a=s.length;n<a;n++)r=s[n],e.toLowerCase()===r.username.toLowerCase()&&(o=r.id);return o===-1?t.boardNotFound():t.sendRequest(o)}}}(this)).fail(this.error)},e.prototype.sendRequest=function(e){return this.reqData.to="mail",this.reqData.touid=e,$.ajax({type:"POST",url:"ajax/forward.php",data:this.reqData,dataType:"json"}).done(function(e){return function(t){return t.success?(BDWM.alert("转寄成功"),e.hide()):9===t.error?BDWM.alert({text:"您没有足够权限执行此操作"}):e.error()}}(this)).fail(this.error)},e.prototype.boardNotFound=function(){return this.$error.show()},e.prototype.hide=function(){return this.dialog.hide()},e.prototype.error=function(){return BDWM.alert({text:"发生错误啦><"})},e}(),window.BDWM.opResend=function(e,t){return e.click(function(e){return e.preventDefault(),new BDWM.OpResend(t)})},BDWM_DIALOG_OP_COLLECT="<div class=\"bdwm-dialog-with-close-icon bdwm-op-collect bdwm-dialog\">\n  <span class='close-icon'></span>\n  <div class='content'>\n    <h4>$name$</h4>\n    <div class='categories'>\n      <span class='bdwm-special-btn'>信息科学技术学院（EECS）精华区</span>\n      <span class='bdwm-special-btn'>信息科学技术学院（EECS）精华区</span>\n    </div>\n    <div class='no-collection' style='display: none'>\n      <span>暂无文集</span>\n    </div>\n  </div>\n</div>",BDWM_DIALOG_OP_COLLECT_EXPLORER="<div class=\"bdwm-dialog-with-close-icon bdwm-op-collect-explorer bdwm-dialog\">\n  <span class='close-icon'></span>\n  <div class='content'>\n    <h4>$name$</h4>\n    <div class='filename' style='display: none;'>\n      <label>文件名</label>\n      <div class='input-container'><input name='filename'></div>\n    </div>\n    <div class='path'>\n    </div>\n    <div class='buttons'>\n      <span class='bdwm-white-btn' data-action='add-directory'>新增目录</span>\n      <span class='bdwm-orange-btn' data-action='import-confirm'>确定</span>\n      <span class='bdwm-white-btn collect-cancel'>取消</span>\n    </div>\n  </div>\n</div>",BDWM_DIALOG_OP_COLLECT_EXPLORER_NEW_DIR="<div class='directory new-directory'>\n  <span class='folder'></span>\n  <input name='dir-name'>\n  <span class='image-container btn-commit'><img src=\"./images/icons/action/iconfont-icoqueding.png\"></span>\n  <span class='image-container btn-cancel'><img src=\"./images/icons/action/iconfont-qingchu.png\"></span>\n</div>",BDWM_OP_COLLECT_DOWNLIST="<ul class='bdwm-down-list'><li data-action='collect-single-post'>单帖</li><li data-action='collect-thread'>同主题</li></ul>",window.BDWM.CollectionRelatedOp=function(){function e(e,t){this.pathPrompt=e,this.onPathSelected=t}return e.prototype.show=function(){return this.downlistClick()},e.prototype.refreshCategories=function(e){var t,i;return null==e&&(e=!1),i="ajax/get_managed_collections.php",t=this.element.find(".categories"),t.html(""),$.ajax({type:"POST",url:i,dataType:"json"}).done(function(i){return function(n){var a,r,o,s,d;if(!n.success)return BDWM.alert({text:"发生错误啦><"});for(0===n.result.length&&i.element.find(".no-collection").show(),d=n.result,o=0,s=d.length;o<s;o++)r=d[o],a=$("<span class='bdwm-special-btn'></span>"),a.html(r.title),a.data("path",r.path),a.data("title",r.title),t.append(a),a.click(i.moveToDirectoryPage.bind(i));return e?e():void 0}}(this)).fail(function(){return BDWM.alert({text:"发生错误啦><"})})},e.prototype.downlistClick=function(e){return this.pageCategory=BDWM.dialogWithCloseIcon($(BDWM_DIALOG_OP_COLLECT.replace("$name$",this.pathPrompt)),{replaceTemplate:!0}),this.element=this.pageCategory.element,this.refreshCategories()},e.prototype.moveToDirectoryPage=function(e){var t,i,n;return this.pageCategory.hide(),this.pageExplorer=BDWM.dialogWithCloseIcon($(BDWM_DIALOG_OP_COLLECT_EXPLORER.replace("$name$",this.pathPrompt)),{replaceTemplate:!0}),this.pageExplorerElement=this.pageExplorer.element,t=$(e.target).data("path"),n=$(e.target).data("title"),this.explorerCore=new BDWM.CollectExplorer(t,n),this.pageExplorerElement.find(".buttons").before(this.explorerCore.jqElement),this.pageExplorerElement.find("[data-action=add-directory]").click(this.addDirectory.bind(this)),i=this,this.pageExplorerElement.find('[data-action="import-confirm"]').click(function(){return i.onPathSelected.call(this,i.explorerCore.currentSelection.basePath)}),this.pageExplorerElement.find(".collect-cancel").click(this.pageExplorer.hide.bind(this.pageExplorer))},e.prototype.addDirectory=function(){return this.explorerCore.currentSelection.addNewDirForm()},e}(),window.BDWM.OpCollect=function(e){function t(e,i,n){this.reqData=i,null==n&&(n=!1),this.importConfirm=bind(this.importConfirm,this),t.__super__.constructor.call(this,"收藏到",this.importConfirm),n?e.click(this.downlistClick.bind(this)):(this.$downlist=$(BDWM_OP_COLLECT_DOWNLIST),e.after(this.$downlist),this.$downlist.find('[data-action="collect-single-post"]').click(this.downlistClick.bind(this)),this.$downlist.find("[data-action=collect-thread]").click(function(e){return function(){return e.modeThread=!0,e.downlistClick()}}(this)),e.click(this.triggerClick.bind(this)))}return extend(t,e),t.prototype.triggerClick=function(e){if(e.preventDefault(),!this.$downlist.is(":visible"))return this.$downlist.slideDown("fast"),setTimeout(function(e){return function(){return $("body").one("click",function(){return e.$downlist.slideUp("fast")})}}(this),0)},t.prototype.importConfirm=function(e){var t;return this.reqData.base=e,t=this.modeThread?"ajax/collection_import_thread.php":"ajax/collection_import.php",$.ajax({type:"POST",url:t,data:this.reqData,dataType:"json"}).done(function(e){return function(t){return t.success?(BDWM.alert({text:"收藏成功"}),e.pageExplorer.hide()):9===t.error?BDWM.alert({text:"您没有足够权限执行此操作"}):BDWM.alert({text:"发生错误啦><"})}}(this)).fail(function(){return BDWM.alert({text:"发生错误啦><"})})},t}(window.BDWM.CollectionRelatedOp),window.BDWM.CollectExplorer=function(){function e(e,t){var i;this.jqElement=$('<div class="bdwm-collect-explorer"></div>'),i=new window.BDWM.CollectExplorer.Directory({title:t},this,e),this.jqElement.append(i.element),i.element.find(".name").click(),i.expandStatusChange(),this.jqElement.perfectScrollbar({wheelPropagation:!1,suppressScrollX:!0,maxScrollbarLength:250,minScrollbarLength:30}),this.currentSelection=this,this.basePath=e}return e.prototype.cancelEntry=function(){return!1},e}(),window.BDWM.CollectExplorer.Directory=function(){function e(e,t,i,n){var a;null==n&&(n=!1),this.addDirectory=bind(this.addDirectory,this),this.addNewDirForm=bind(this.addNewDirForm,this),a=e.title,this.container=t,this.basePath=i,null!=e.path&&(this.basePath=this.basePath+"/"+e.path),this.dataStatus=0,n&&(this.dataStatus=2),this.expanding=!1,this.creatingNewDir=!1,this.subDirectories=[],this.element=$('<div class="directory" data-offset="0"></div>'),this.element.append($('<span class="name folder"></span>').text(a)),this.element.find(".name").click(this.active.bind(this)),this.viewRefreshExpanding()}return e.prototype.loadSubDirData=function(e){var t;return null==e&&(e=null),t="ajax/get_collection_items.php",this.dataStatus=1,this.viewRefreshExpanding(),$.ajax({type:"POST",url:t,data:{path:this.basePath},dataType:"json"}).done(function(t){return function(i){var n,a,r,o,s,d;if(s=_.filter(i.result,function(e){return e.isdir}),t.dataStatus=2,s.length>0)for(t.viewAddExpandable(),t.expanding=!0,d=t.element.find(".sub-dir"),a=0,r=s.length;a<r;a++)n=s[a],o=new window.BDWM.CollectExplorer.Directory(n,t.container,t.basePath),d.append(o.element),t.subDirectories.push(o);if(t.viewRefreshExpanding(),e)return e()}}(this))},e.prototype.viewRefreshExpanding=function(){return 0===this.dataStatus?this.viewAddExpandable():1===this.dataStatus?(this.viewRemoveExpandable(),this.viewAddDataLoading()):2===this.dataStatus?(this.viewRemoveDataLoading(),0!==this.subDirectories.length||this.creatingNewDir?(this.viewAddExpandable(),this.expanding?this.viewExpanding():this.viewCollapse()):this.viewRemoveExpandable()):void 0},e.prototype.active=function(e){var t,i;return $(".directory.active").removeClass("active"),this.element.addClass("active"),this.container.currentSelection&&this.container.currentSelection.cancelEntry(),this.container.currentSelection=this,i=this.element.offset().left-this.container.jqElement.offset().left,this.element.find(".active-flag").remove(),this.element.prepend($('<span class="active-flag"></span>')),t=this.element.find(".active-flag"),t.css({left:-i,width:"448px"}),e.stopPropagation()},e.prototype.expandStatusChange=function(){return 0===this.dataStatus?this.loadSubDirData():2===this.dataStatus?(this.element.hasClass("expand")?this.expanding=!1:this.expanding=!0,this.viewRefreshExpanding()):void 0},e.prototype.viewExpanding=function(){return this.element.find(">.status-indicator").html("-"),this.element.find(">.sub-dir").show(200),this.element.addClass("expand")},e.prototype.viewCollapse=function(){return this.element.find(">.status-indicator").html("+"),this.element.find(">.sub-dir").hide(100),this.element.removeClass("expand")},e.prototype.viewAddExpandable=function(){var e;if(!this.element.hasClass("expandable"))return this.element.addClass("expandable"),this.element.prepend($("<span class='status-indicator'>+</span>")),this.element.find(".status-indicator").click(this.expandStatusChange.bind(this)),this.element.append($("<div class='sub-dir'></div>")),e=this.element.find(".sub-dir"),e.hide()},e.prototype.viewRemoveExpandable=function(){if(this.element.hasClass("expandable"))return this.element.removeClass("expandable"),this.element.find(">.status-indicator").remove(),this.element.find(">.sub-dir").remove()},e.prototype.viewAddDataLoading=function(){if(0===this.element.find(".status-indicator-loading").length)return this.element.prepend($("<span class='status-indicator-loading'><img src='images/libs/bdwm.operations/ajax_clock_small.gif'></span>"))},e.prototype.viewRemoveDataLoading=function(){return this.element.find(".status-indicator-loading").remove()},e.prototype.addNewDirForm=function(){return this.cancelEntry(),0===this.dataStatus?this.loadSubDirData(this.addNewDirForm):2===this.dataStatus?(this.creatingNewDir=!0,this.viewAddExpandable(),this.expanding=!0,this.newEntry=$(BDWM_DIALOG_OP_COLLECT_EXPLORER_NEW_DIR),this.element.find(">.sub-dir").append(this.newEntry),this.newEntry.find(".btn-commit").click(this.commitEntry.bind(this)),this.newEntry.find(".btn-cancel").click(this.cancelEntry.bind(this)),this.newEntry.find("input").focus(),this.viewRefreshExpanding()):void 0},e.prototype.commitEntry=function(e){var t;return t=this.newEntry.find("input").val(),$.ajax({type:"POST",url:"ajax/create_collection_dir.php",data:{base:this.basePath,title:t,bms:""},dataType:"json"}).done(this.addDirectory).fail(function(){return BDWM.alert({text:"发生错误啦><"})})},e.prototype.cancelEntry=function(e){if(this.newEntry&&(this.newEntry.remove(),this.creatingNewDir=!1,!this.subDirectories||0===this.subDirectories.length))return this.expanding=!1,this.viewRefreshExpanding()},e.prototype.addDirectory=function(e){var t,i;return e.success?(t={title:this.newEntry.find("input").val(),path:e.name},i=new window.BDWM.CollectExplorer.Directory(t,this.container,this.basePath,(!0)),this.element.find(">.sub-dir").append(i.element),this.subDirectories.push(i),this.newEntry.remove(),this.newEntry=null,this.creatingNewDir=!1):9===e.error?BDWM.alert({text:"您没有足够权限执行此操作"}):BDWM.alert({text:"发生错误啦><"})},e}(),window.BDWM.opCollect=function(e,t,i){return null==i&&(i=!1),new BDWM.OpCollect(e,t,i)},function(){return window.BDWM||(window.BDWM={}),BDWM.ChattingMessage=function(){function e(e){this.options=null!=e?e:{},this.id=this.options.id,this.from=this.options.from,this.to=this.options.to,this.message=this.options.message,this.time=this.options.time,this.status=this.options.status,"undefined"==typeof this.id&&(this.id=-(new Date).getTime()),"undefined"==typeof this.from&&(this.from=-1),"undefined"==typeof this.to&&(this.to=-1),"undefined"==typeof this.message&&(this.message=""),"undefined"==typeof this.time&&(this.time="Mon Jun 01 1970 21:00:00 GMT+0000"),"undefined"==typeof this.status&&(this.status="pending"),this.time=new Date(this.time)}return e.prototype.toString=function(){return JSON.stringify(this,["id","from","to","message","time","status"])},e}(),BDWM.ChattingPeer=function(){function e(e){this.options=null!=e?e:{},this.id=this.options.id,this.username=this.options.username,this.avatar=this.options.avatar,this.name=this.options.name,this.unread=this.options.unread,this.hide=this.options.hide,this.updatedAt=this.options.updatedAt,this.loading=this.options.loading,this.messageMin=this.options.messageMin,this.messageMax=this.options.messageMax,"undefined"==typeof this.id&&(this.id=""),"undefined"==typeof this.username&&(this.username=this.id),"undefined"==typeof this.avatar&&(this.avatar=""),"undefined"==typeof this.name&&(this.name=this.id),"undefined"==typeof this.unread&&(this.unread=0),"undefined"==typeof this.hide&&(this.hide=!1),"undefined"==typeof this.updatedAt&&(this.updatedAt="Mon Jun 01 1970 21:00:00 GMT+0000"),"undefined"==typeof this.loading&&(this.loading=!1),"undefined"==typeof this.messageMax&&(this.messageMax=null),"undefined"==typeof this.messageMin&&(this.messageMin=null),this.id=this.id.toLowerCase(),this.updatedAt=new Date(this.updatedAt)}return e.prototype.toString=function(){return JSON.stringify(this,["id","username","avatar","name","unread","hide","updatedAt","loading","messageMax","messageMin"])},e}(),BDWM.ChattingStorage=function(){function e(e){this.options=e,this.messageLimitPerPeer=50,this.messages={},this.peers={},this.messageLists={},this.selfId=this.options.selfId,this.selfPeer=this.getPeerOrNew(this.selfId),this.selfId=this.selfId.toLowerCase(),this.loadPeerList(),this.selfPeer.hide=!0,this.setPeer(this.selfPeer),this.bugEraser()}return e.prototype.bugEraser=function(){return this.setItem("messageList",this.selfId,JSON.stringify([]))},e.prototype.setItem=function(e,t,i){if(BDWM.storage.available)return BDWM.storage.set(e+"_"+t,i)},e.prototype.getItem=function(e,t){return BDWM.storage.available?BDWM.storage.get(e+"_"+t):void 0},e.prototype.removeItem=function(e,t){return BDWM.storage.available?BDWM.storage.remove(e+"_"+t):void 0},e.prototype.setMessage=function(e){var t;return this.messages[e.id]=new BDWM.ChattingMessage(e),this.setItem("message",e.id,e.toString()),t=e.from.toLowerCase()===this.selfId.toLowerCase()?e.to:e.from,e.id<0||this.insertList(t,e.id)},e.prototype.getMessage=function(e){var t;return t=this.messages[e],t||(t=this.getItem("message",e),t&&(t=new BDWM.ChattingMessage(JSON.parse(t)))),t?(this.messages[e]=t,t):null},e.prototype.updatePeer=function(e){return this.peers[e.id]=new BDWM.ChattingPeer(e),this.setItem("peer",e.id,e.toString())},e.prototype.setPeer=function(e){return this.peers[e.id]=new BDWM.ChattingPeer(e),this.setItem("peer",e.id,e.toString()),this.insertPeerList(e.id)},e.prototype.getPeer=function(e){var t;return e=e.toLowerCase(),t=this.peers[e],t||(t=this.getItem("peer",e),t&&(t=new BDWM.ChattingPeer(JSON.parse(t)))),t?(this.peers[e]=t,t):null},e.prototype.getPeerOrNew=function(e){var t;return t=this.getPeer(e),t||(t=new BDWM.ChattingPeer({id:e}),"deliver"===t.id&&(t.name="系统消息",t.avatar="images/logo.jpg"),this.setPeer(t)),t},e.prototype.setList=function(e,t){var i;return this.messageLists[e]=t,i=this.getPeer(e),i.messageMin=t[0],i.messageMax=t[t.length-1],this.setItem("messageList",e,JSON.stringify(t)),this.setPeer(i)},e.prototype.getList=function(e){var t;return t=this.messageLists[e],t||(t=JSON.parse(this.getItem("messageList",e))),t||(t=[]),this.messageLists[e]=t,t},e.prototype.insertList=function(e,t){var i,n,a,r;return r=this,i=this.getList(e),a=_.sortedIndex(i,t),!(a<i.length&&i[a]===t)&&(i.splice(a,0,t),i.length>this.messageLimitPerPeer&&(n=i.splice(0,i.length-this.messageLimitPerPeer),_.each(n,function(e){return r.getItem("message",e)})),this.setList(e,i),!0)},e.prototype.setUnread=function(e){return this.setItem("unread",this.selfId,e)},e.prototype.getUnread=function(){var e;return e=this.getItem("unread",this.selfId),e||(e=0),parseInt(e)},e.prototype.calcUnread=function(){var e;return e=0,_.each(this.peerList,function(t){if(!t.hide)return e+=t.unread;
}),this.setUnread(e),e},e.prototype.insertPeerList=function(e){var t;if(t=_.find(this.peerList,function(t){return t===e}),!t)return this.peerList.splice(0,0,e),this.setItem("peerList",this.selfId,JSON.stringify(this.peerList))},e.prototype.removeFromPeerList=function(e){return this.peerList=_.filter(this.peerList,function(t){return t!==e}),this.setItem("peerList",this.selfId,JSON.stringify(this.peerList))},e.prototype.loadPeerList=function(){return this.peerList=this.getItem("peerList",this.selfId),this.peerList?this.peerList=JSON.parse(this.peerList):this.peerList=[]},e}()}.call(),function(){var e,t,i;return window.BDWM||(window.BDWM={}),t="/http-bind/",e=1===window.test?"localhost":"bdwm.net",i="./ajax/send_message.php",window.BDWM.ChattingConnector=function(){function n(i){var n;this.options=null!=i?i:{},this.uid=this.options.uid,this.storage=this.options.storage,this.key=this.options.key,this.loadMessageTimer=null,this.onMessageListeners=[],this.onConnectListeners=[],this.onUpdatePeerListeners=[],n=this.uid+"@"+e+"/web_"+Math.round(1e4*Math.random()).toString().substring(0,10)+(new Date).getTime(),this.uid&&this.key&&this.storage?(this.connection=new Strophe.Connection(t),this.connection.connect(n,this.key,this._onConnect.bind(this)),this.initialized=!0):this.initialized=!1}return n.prototype.disconnect=function(){return this.connection.disconnect()},n.prototype.connect=function(){var i,n;return i=this,!!this.initialized&&(this.connected?void 0:(this.connection||(this.connection=new Strophe.Connection(t)),n=this.uid+"@"+e+"/web_"+Math.round(1e4*Math.random()).toString().substring(0,10)+(new Date).getTime(),this.connection.connect(n,this.key,this._onConnect.bind(this))))},n.prototype.onConnect=function(e){return this.onConnectListeners.push(e)},n.prototype.onMessage=function(e){return this.onMessageListeners.push(e)},n.prototype.onUpdatePeer=function(e){return this.onUpdatePeerListeners.push(e)},n.prototype.triggerOnConnect=function(e){return _.each(this.onConnectListeners,function(t){var i,n;try{return t(e)}catch(n){i=n}})},n.prototype.triggerOnMessage=function(e,t){return null==t&&(t=!1),_.each(this.onMessageListeners,function(i){var n,a;try{return i(e,t)}catch(a){n=a}})},n.prototype.triggerOnUpdatePeer=function(e){return _.each(this.onUpdatePeerListeners,function(t){var i,n;try{return t(e)}catch(n){i=n}})},n.prototype._onConnect=function(e){return e===Strophe.Status.CONNECTING?(this.log("Strophe is connecting."),this.connected=!0):e===Strophe.Status.CONNFAIL?(this.log("Strophe failed to connect."),this.connected=!1):e===Strophe.Status.DISCONNECTING?this.log("Strophe is disconnecting."):e===Strophe.Status.DISCONNECTED?(this.log("Strophe is disconnected."),this.connected=!1):e===Strophe.Status.CONNECTED&&(this.log("Strophe is connected."),this.connected=!0,this.connection.addHandler(this._onMessage.bind(this),null,"message",null,null,null),this.connection.send($pres().tree())),this.triggerOnConnect(this.connected)},n.prototype._onMessage=function(e){var t,i,n,a,r,o,s;return i=$(e),s=i.attr("type"),t=i.attr("from"),o=i.attr("to"),"chat"===s&&(n=$("body",i).text(),r=t.replace(/\/[^\/]+$/,"").replace(/@bdwm\.net$/,"").replace(/@localhost$/,""),r.toLowerCase()!==this.uid.toLowerCase()&&(a=this.storage.getPeerOrNew(r),this.loadNewMessages(a,!0))),console.log("message type: "+s),!0},n.prototype.doSend=function(e,t,n){return $.ajax({type:"POST",url:i,data:{user:e.id,content:t},dataType:"json",timeout:5e3}).done(function(e){return n(e.success?!0:!1)}).fail(function(){return n(!1)})},n.prototype.loadNewMessages=function(e,t){var i,n;return null==t&&(t=!1),n=this,i=function(i){return i&&i.length>0&&_.each(i,function(t){return t=new BDWM.ChattingMessage({id:t.id,from:0===t.dir?e.id:n.uid,to:0===t.dir?n.uid:e.id,message:t.content,time:new Date(1e3*t.time)}),n.storage.setMessage(t)}),n.triggerOnMessage(e,t)},n.doLoadMessage(e.id,null,null,i)},n.prototype.updatePeerInfo=function(e){var t,i,n;if(n=this,t=this.storage.getPeer(e),!(null===t||t.loading||(new Date).getTime()-t.updatedAt.getTime()<864e5))return"deliver"===t.id?(t.name="系统消息",t.avatar="images/logo.jpg",n.storage.setPeer(t),void _.each(n.onUpdatePeerListeners,function(e){return e(t)})):(i=[],i.push(e),t.loading=!0,n.storage.setPeer(t),$.ajax({type:"post",dataType:"json",url:"ajax/get_userinfo_by_names.php",data:{names:JSON.stringify([e])}}).done(function(e){var i;return e.success&&(i=e.result[0],i&&(t.name=i.username,t.avatar=i.avatar,t.updatedAt=new Date,n.storage.updatePeer(t))),t.loading=!1,n.storage.setPeer(t),_.each(n.onUpdatePeerListeners,function(e){return e(t)})}).fail(function(){return t.loading=!1,n.storage.setPeer(t),_.each(n.onUpdatePeerListeners,function(e){return e(t)})}))},n.prototype.log=function(e){return console.log("Strophe: "+e)},n.prototype.doLoadMessage=function(e,t,i,n){var a;return a={"with":e,num:50},i&&(a.start=i),t&&(a.end=t),$.ajax({type:"post",data:a,dataType:"json",url:"ajax/get_messages.php"}).done(function(e){return n(e.success?e.result:!1)}).fail(function(){return n(!1)})},n.prototype.doSetMessageRead=function(e,t){var i;return null==t&&(t=function(){}),i={"with":e},$.ajax({type:"post",data:i,dataType:"json",url:"ajax/set_user_message_read.php"}).done(function(e){return t(e.success?!0:!1)}).fail(function(){return t(!1)})},n.prototype.doGetMessageUnreadCounts=function(e){return $.ajax({type:"post",dataType:"json",url:"ajax/get_unread_message_counts.php"}).done(function(t){return e(t.success?t.result:!1)}).fail(function(){return e(!1)})},n.prototype.doSearchPeer=function(e,t){return $.ajax({type:"post",dataType:"json",url:"ajax/get_topsearch.php",data:{pref:e},timeout:1e3}).done(function(e){return t(e.success?e.users:!1)}).fail(function(){return t(!1)})},n.prototype.doGetFriends=function(e){return $.ajax({type:"post",dataType:"json",url:"ajax/get_friends.php"}).done(function(t){return e(t.success?t.result:!1)}).fail(function(){return e(!1)})},n.prototype.getUserinfoByNames=function(e,t){return $.ajax({type:"post",dataType:"json",url:"ajax/get_userinfo_by_names.php",data:{names:JSON.stringify(e)}}).done(function(e){return t(e.success?e.result:!1)}).fail(function(){return t(!1)})},n.prototype.getSearchList=function(e,t){var i;return i=this,i.doSearchPeer(e,function(e){if(e)return t(e)})},n}()}.call(),function(){var e,t,i;return t="<div class='bdwm-chatting' id='bdwm-chatting'>\n  <a class='bdwm-chatting-toggle' data-action='bdwm-chatting-on'><i class='reverse-color bdwm-chatting-iconfont'>&#xe642; </i><span class='bdwm-chatting-toggle-text'>消息</a>\n  <div class='bdwm-chatting-main'>\n    <div class='bdwm-chatting-main-left'>\n      <div class='bdwm-chatting-main-top'><a class='bdwm-chatting-new-input-placeholder' data-action='bdwm-chatting-new'>新建聊天</a><input class='bdwm-chatting-new-input' data-role='bdwm-chatting-new-name' style='display:none'></div>\n      <div class='bdwm-chatting-main-list'>\n<div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>lzqlzqlzqaaaa</span><span class='bdwm-chatting-main-list-count'><span class='safari-font-fix-to-12px'>1</span></span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div class='active'><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>InvalidID</span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>曾老板</span><span class='bdwm-chatting-main-list-count'><span class='safari-font-fix-to-12px'>12</span></span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>lzqlzqlzqaaaa</span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>lzqlzqlzqaaaa</span><span class='bdwm-chatting-main-list-right-arrow'><i class='bdwm-chatting-iconfont'>&#xe647;</i></span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>InvalidID</span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>曾老板</span><span class='bdwm-chatting-main-list-count'><span class='safari-font-fix-to-12px'>12</span></span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>lzqlzqlzqaaaa</span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>曾老板</span><span class='bdwm-chatting-main-list-count'><span class='safari-font-fix-to-12px'>12</span></span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n        <div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'>lzqlzqlzqaaaa</span><i data-action=\"bdwm-chatting-main-list\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>\n</div>\n      </div>\n    </div>\n    <div class='bdwm-chatting-main-right'>\n      <div class='bdwm-chatting-main-top'><span class='bdwm-chatting-main-name'>Zakelly</span></div>\n      <div class='bdwm-chatting-main-bottom'>\n        <div class='bdwm-chatting-main-textarea-wrapper'><textarea rows=\"1\" class='bdwm-custom-scroll-bar bdwm-chatting-main-textarea' data-role='bdwm-chatting-new-message'></textarea></div>\n        <a class='bdwm-chatting-main-emoji-trigger' data-action='bdwm-chatting-main-emoji-trigger'><i class='bdwm-chatting-iconfont'>&#xe7d4;</i></a>\n        <div class='bdwm-chatting-main-emoji-panel' tabindex=-1 style='display: none'>\n          <div class='bdwm-chatting-main-emoji-panel-board-wrapper'>\n            <div class='bdwm-chatting-main-emoji-panel-board-list'>\n            <!--here inited by the initEmojis function-->\n            </div>\n          </div>\n          <div class='bdwm-chatting-main-emoji-panel-page-list'>\n            <!--here inited by the initEmojis function-->\n          </div>\n        </div>\n      </div>\n      <div class='bdwm-chatting-main-content'>\n        <div class='bdwm-chatting-main-message-wrapper'>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-info'>\n            <span>昨日 17:20</span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat bdwm-chatting-main-message-chat-left'>\n            <span class='bdwm-chatting-main-message-chat-avatar'><img ></span>\n            <span class='bdwm-chatting-main-message-chat-content'><span>如果早知道我今天混成这个样子，我当初就应该好好学习了</span></span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat bdwm-chatting-main-message-chat-right'>\n            <span class='bdwm-chatting-main-message-chat-avatar'><img ></span>\n            <span class='bdwm-chatting-main-message-chat-content bdwm-chatting-main-message-chat-warning'><span>早知道你都发财了</span></span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-info bdwm-chatting-main-message-info-right'>\n            <span>由于对方设置，这条消息无法发送</span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat bdwm-chatting-main-message-chat-right'>\n            <span class='bdwm-chatting-main-message-chat-avatar'><img ></span>\n            <span class='bdwm-chatting-main-message-chat-content'><span>早知道你都发财了</span></span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-info'>\n            <span>昨日 17:20</span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat bdwm-chatting-main-message-chat-left'>\n            <span class='bdwm-chatting-main-message-chat-avatar'><img ></span>\n            <span class='bdwm-chatting-main-message-chat-content'><span>如果早知道我今天混成这个样子，我当初就应该好好学习了</span></span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat bdwm-chatting-main-message-chat-right'>\n            <span class='bdwm-chatting-main-message-chat-avatar'><img ></span>\n            <span class='bdwm-chatting-main-message-chat-content bdwm-chatting-main-message-chat-warning'><span>早知道你都发财了</span></span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-info bdwm-chatting-main-message-info-right'>\n            <span>由于对方设置，这条消息无法发送</span>\n          </div>\n          <div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat bdwm-chatting-main-message-chat-right'>\n            <span class='bdwm-chatting-main-message-chat-avatar'><img ></span>\n            <span class='bdwm-chatting-main-message-chat-content'><span>早知道你都发财了</span></span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <a class='bdwm-chatting-close' data-action='bdwm-chatting-off'><i class='bdwm-chatting-iconfont'>&#xe6de;</i></a>\n  </div>\n</div>",e="<div class='bdwm-chatting' id='bdwm-chatting'>\n  <a class='bdwm-chatting-toggle' data-action='bdwm-chatting-on'><i class='reverse-color bdwm-chatting-iconfont'>&#xe642; </i><span class='bdwm-chatting-toggle-text'>消息</a>\n  <div class='bdwm-chatting-main'>\n    <div class='bdwm-chatting-main-left'>\n      <div class='bdwm-chatting-main-top'><a class='bdwm-chatting-new-input-placeholder' data-action='bdwm-chatting-new'>新建聊天</a><input class='bdwm-chatting-new-input' data-role='bdwm-chatting-new-name' style='display:none'></div>\n      <div class='bdwm-chatting-main-list'>\n        <div>\n        </div>\n      </div>\n    </div>\n    <div class='bdwm-chatting-main-right'>\n      <div class='bdwm-chatting-main-top'><span class='bdwm-chatting-main-name'></span></div>\n      <div class='bdwm-chatting-main-bottom'>\n        <div class='bdwm-chatting-main-textarea-wrapper'><textarea rows=\"1\" class='bdwm-custom-scroll-bar bdwm-chatting-main-textarea' data-role='bdwm-chatting-new-message'></textarea></div>\n        <a class='bdwm-chatting-main-emoji-trigger' data-action='bdwm-chatting-main-emoji-trigger'><i class='bdwm-chatting-iconfont'>&#xe7d4;</i></a>\n        <div class='bdwm-chatting-main-emoji-panel' tabindex=-1 style='display: none'>\n          <div class='bdwm-chatting-main-emoji-panel-board-wrapper'>\n            <div class='bdwm-chatting-main-emoji-panel-board-list'>\n            <!--here inited by the initEmojis function-->\n            </div>\n          </div>\n          <div class='bdwm-chatting-main-emoji-panel-page-list'>\n            <!--here inited by the initEmojis function-->\n          </div>\n        </div>\n      </div>\n      <div class='bdwm-chatting-main-content'>\n        <div class='bdwm-chatting-main-message-wrapper'>\n        </div>\n      </div>\n    </div>\n    <a class='bdwm-chatting-close' data-action='bdwm-chatting-off'><i class='bdwm-chatting-iconfont'>&#xe6de;</i></a>\n  </div>\n</div>",i=["[微笑]","[撇嘴]","[色]","[发呆]","[得意]","[流泪]","[害羞]","[闭嘴]","[睡]","[大哭]","[尴尬]","[发怒]","[调皮]","[呲牙]","[惊讶]","[难过]","[酷]","[冷汗]","[抓狂]","[吐]","[偷笑]","[愉快]","[白眼]","[傲慢]","[饥饿]","[困]","[惊恐]","[流汗]","[憨笑]","[悠闲]","[奋斗]","[咒骂]","[疑问]","[嘘]","[晕]","[疯了]","[衰]","[骷髅]","[敲打]","[再见]","[擦汗]","[抠鼻]","[鼓掌]","[糗大了]","[坏笑]","[左哼哼]","[右哼哼]","[哈欠]","[鄙视]","[委屈]","[快哭了]","[阴险]","[亲亲]","[吓]","[可怜]","[菜刀]","[西瓜]","[啤酒]","[篮球]","[乒乓]","[咖啡]","[饭]","[猪头]","[玫瑰]","[凋谢]","[嘴唇]","[爱心]","[心碎]","[蛋糕]","[闪电]","[炸弹]","[刀]","[足球]","[瓢虫]","[便便]","[月亮]","[太阳]","[礼物]","[拥抱]","[强]","[弱]","[握手]","[胜利]","[抱拳]","[勾引]","[拳头]","[差劲]","[爱你]","[NO]","[OK]","[爱情]","[飞吻]","[跳跳]","[发抖]","[怄火]","[转圈]","[磕头]","[回头]","[跳绳]","[投降]"],window.BDWM||(window.BDWM={}),window.BDWM.ChattingComponents=function(){function t(){this.body=$(e).appendTo($("body")),this.flashTimer=null,this.activePeer=null,this.isSearching=!1,this.handlers={},this.initUIHandler()}return t.prototype.initUIHandler=function(){var e;return e=this,this.searchTimer=null,this.body.find('[data-action="bdwm-chatting-on"]').click(function(t){return e.open.bind(e)(),t.stopPropagation()}),this.body.find('[data-action="bdwm-chatting-off"]').click(this.close.bind(this)),this.body.find('[data-action="bdwm-chatting-new"]').click(function(){return e.startSearch(),!1}),$("body").click(this.close.bind(this)),this.body.click(function(e){return e.stopPropagation()}),this.body.click(function(){return e.endSearch(),null!==e.searchTimer&&clearTimeout(e.searchTimer),setTimeout(function(){return e.showList()},50),!0}),this.body.find('[data-role="bdwm-chatting-new-name"]').blur(function(){return!1}).on("change input propertychange",function(){var t;if(e.isSearching)return null!==e.searchTimer&&clearTimeout(e.searchTimer),e.searchTimer=null,t=$(this).val(),t.length<2?e.showList():e.searchTimer=setTimeout(function(){return e.searchTimer=null,e.showSearchList(t)},500)}).on("keydown",function(t){if(e.isSearching)return 13===t.keyCode?(e.searchFirst&&(e.endSearch(),e.changeActivePeer(e.searchFirst)),!1):void 0}),this.body.find(".bdwm-chatting-main-list").perfectScrollbar({wheelPropagation:!1,suppressScrollX:!0,maxScrollbarLength:80,minScrollbarLength:30}),this.body.find(".bdwm-chatting-main-content").perfectScrollbar({wheelPropagation:!1,suppressScrollX:!0,maxScrollbarLength:80,minScrollbarLength:30}).one("ps-y-reach-start",function(){return!0}),this.body.find('[data-role="bdwm-chatting-new-message"]').on("keydown",function(t){return 13!==t.keyCode||(!!t.ctrlKey||($(this).val().length&&(e.sendMessage($(this).val()),$(this).val(""),e.scrollToBottom(),e.body.find('[data-action="bdwm-chatting-main-emoji-trigger"]').removeClass("active"),e.body.find(".bdwm-chatting-main-emoji-panel").hide()),!1))}).on("change input propertychange keydown",function(){return $(this).removeAttr("style"),this.scrollHeight<39?$(this).height(20).parent().removeClass("extend"):$(this).height(40).parent().addClass("extend")}).change(),this.autoClosePanel=!0,this.initEmojis(100),this.body.find('[data-action="bdwm-chatting-main-emoji-trigger"]').click(function(){return e.autoClosePanel=!1,$(this).hasClass("active")?($(this).removeClass("active"),e.body.find(".bdwm-chatting-main-emoji-panel").hide()):($(this).addClass("active"),e.body.find(".bdwm-chatting-main-emoji-panel").show().focus(),e.body.find('[data-role="bdwm-chatting-new-message"]').focus()),e.autoClosePanel=!0,!1}),this.body.find('.bdwm-chatting-main-emoji-panel,[data-role="bdwm-chatting-new-message"]').blur(function(){return!e.autoClosePanel||e.body.find(".bdwm-chatting-main-emoji-panel").is(":hover")||e.body.find(".bdwm-chatting-main-emoji-panel").is(":focus")||e.body.find('[data-role="bdwm-chatting-new-message"]').is(":focus")||e.body.find('[data-action="bdwm-chatting-main-emoji-trigger"]').is(":hover")||(e.body.find('[data-action="bdwm-chatting-main-emoji-trigger"]').removeClass("active"),e.body.find(".bdwm-chatting-main-emoji-panel").hide()),!1}),this.body.find('[data-action="bdwm-chatting-insert-emoji"]').click(function(){var t,n;return e.autoClosePanel=!1,t=i[parseInt($(this).data("emoji-num"))-1],n=e.body.find('[data-role="bdwm-chatting-new-message"]').focus(),"disabled"!==n.attr("disabled")&&(n.selection("replace",{text:t,caret:"end"}),n.change()),e.autoClosePanel=!0,!1}),this.body.click(function(){}),this.changeActivePeer(null)},t.prototype.startSearch=function(e){return null==e&&(e=null),this.isSearching=!0,e?this.body.find('[data-role="bdwm-chatting-new-name"]').show().val(e).focus().change():this.body.find('[data-role="bdwm-chatting-new-name"]').show().focus().change()},t.prototype.endSearch=function(){return this.isSearching=!1,this.body.find('[data-role="bdwm-chatting-new-name"]').val("").change().hide()},t.prototype.bind=function(e,t){return this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},t.prototype.trigger=function(e,t,i){var n;if(null==i&&(i=function(){}),this.handlers[e])return n=this,_.each(this.handlers[e],function(a){return console.log("trigger: "+e),a.call(n,t,i.bind(n))})},t.prototype.initEmojis=function(e){var t,i,n,a,r,o,s,d,c;for(i=0,o=0,c=this,d=[];i<e;){for(t=$('<div class="bdwm-chatting-main-emoji-panel-board"></div>'),this.body.find(".bdwm-chatting-main-emoji-panel-board-list").append(t),o++,n=1;n<=5;n++){for(r=$('<div class="bdwm-chatting-main-emoji-panel-board-line"></div>'),t.append(r),a=1;a<=11&&(i++,r.append('<a data-action="bdwm-chatting-insert-emoji" data-emoji-num="'+i+'"><img src="images/emoji/Expression_'+i+'.png"></a>'),!(i>=e));a++);if(i>=e)break}s=$('<a class="bdwm-chatting-main-emoji-panel-page-point" data-action="bdwm-chatting-main-emoji-page-change" data-page="'+o+'"></a>'),this.body.find(".bdwm-chatting-main-emoji-panel-page-list").append(s),1===o&&s.addClass("active"),d.push(s.click(function(){return $(this).siblings().removeClass("active"),$(this).addClass("active"),c.body.find(".bdwm-chatting-main-emoji-panel-board-list").animate({marginLeft:-316*(parseInt($(this).data("page"))-1)})}))}return d},t.prototype.setUnread=function(e){return e<=0?this.body.find(".bdwm-chatting-toggle-text").text("消息"):this.body.find(".bdwm-chatting-toggle-text").html('<span class="red" style="margin-right: 3px; line-height: 20px;">'+e+"</span>条新消息"),this},t.prototype.startFlash=function(){var e,t;return t=this,e=function(){var e;return e=t.body.find(".bdwm-chatting-toggle"),e.hasClass("flash-on")?e.removeClass("flash-on"):e.addClass("flash-on")},t.flashTimer||(t.flashTimer=setInterval(e,1400)),this},t.prototype.stopFlash=function(){var e;return e=this,null!==e.flashTimer&&(clearInterval(e.flashTimer),e.flashTimer=null),e.body.find(".bdwm-chatting-toggle").removeClass("flash-on"),this},t.prototype.open=function(){return this.body.addClass("bdwm-chatting-open"),this.showList(),this.stopFlash(),this},t.prototype.isOpen=function(){return this.body.hasClass("bdwm-chatting-open")},t.prototype.close=function(){return this.body.hasClass("bdwm-chatting-open")&&this.stopFlash(),this.body.removeClass("bdwm-chatting-open"),this},t.prototype.showList=function(e){var t;if(null==e&&(e=!0),t=this,e)t.searchFirst=null;else if(this.isSearching)return;return this.trigger("getPeers",null,function(e){var i,n;return i=t.body.find(".bdwm-chatting-main-list >div:first-child"),i.children().remove(),n=0,_.each(e,function(e){var a;return e&&!e.hide&&(a=0!==e.unread?$("<div><span class='bdwm-chatting-main-list-avatar'><img class='avatar'></span><span class='bdwm-chatting-main-list-name limit'></span><span class='bdwm-chatting-main-list-count'><span></span></span><i data-action=\"bdwm-chatting-main-list-delete\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>"):$("<div><span class='bdwm-chatting-main-list-avatar'><img class='avatar'></span><span class='bdwm-chatting-main-list-name limit'></span><i data-action=\"bdwm-chatting-main-list-delete\" class='bdwm-chatting-iconfont'>&#xe6de;</i></div>"),n+=e.unread,a.find(".bdwm-chatting-main-list-name").text(e.name),e.avatar.length>0&&a.find(".bdwm-chatting-main-list-avatar >img.avatar").attr("src",e.avatar),a.find(".bdwm-chatting-main-list-count >span").text(e.unread),a.attr("data-peer-id",e.id),t.activePeer&&t.activePeer.id===e.id&&a.addClass("active"),a.click(function(){return t.changeActivePeer(e),t.endSearch(),$(this).addClass("active"),$(this).siblings().removeClass("active"),!1}),a.find('[data-action="bdwm-chatting-main-list-delete"]').click(function(){return t.deletePeer(e),$(this).parent().remove(),!1}),i.append(a)),!0}),t.setUnread(n),t.body.find(".bdwm-chatting-main-list").perfectScrollbar("update")})},t.prototype.parseMessageItem=function(e){var t,n,a,r,o,s,d,c,l,h;for(r="",r="timeout"===e.status?$("<div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat'>\n  <span class='bdwm-chatting-main-message-chat-avatar'><img class='avatar'></span>\n  <span class='bdwm-chatting-main-message-chat-content bdwm-chatting-main-message-chat-warning'><span></span></span>\n</div>\n<div class='bdwm-chatting-main-message bdwm-chatting-main-message-info bdwm-chatting-main-message-info-right'>\n  <span>发送超时</span>\n</div>"):$("<div class='bdwm-chatting-main-message bdwm-chatting-main-message-chat'>\n  <span class='bdwm-chatting-main-message-chat-avatar'><img class='avatar'></span>\n  <span class='bdwm-chatting-main-message-chat-content'><span></span></span>\n</div>"),s=e.fromPeer,r.attr("data-peer-id",s.id),s&&s.avatar.length>0&&r.find(".bdwm-chatting-main-message-chat-avatar >img.avatar").attr("src",s.avatar),c=e.message,d=Math.random().toString()+"|";c.indexOf(d)>=0;)d=Math.random().toString()+"|";for(_.each(i,function(e,t){var i;return i=new RegExp("\\"+e.substr(0,e.length-1)+"\\]","g"),c=c.replace(i,d+'<img src="images/emoji/Expression_'+(t+1)+'.png">'+d)}),c=c.replace("(TERM下按g直接查看)",""),a=new RegExp("(http|ftp|https):\\/\\/[\\w\\-_]+(\\.[\\w\\-_]+)+([\\w\\-\\.,@?^=%&:/~\\+#]*[\\w\\-\\@?^=%&/~\\+#])?","g"),o=c;null!==(t=a.exec(c));)n=t[0],o="deliver"===s.id?o.replace(n,d+'<a data-pjax="'+n+'">[点此查看]</a>'+d):o.replace(n,d+'<a data-pjax="'+n+'">'+n+"</a>"+d);return c=o,l=r.find(".bdwm-chatting-main-message-chat-content >span"),h=c.split(d),_.each(h,function(e,t){var i;return t%2!==1?l.append($("<span></span>").text(e)):(i=$(e),l.append(i),i.attr("data-pjax")?(n=$(i).data("pjax"),n.indexOf("bbs.pku.edu.cn")>=0||n.indexOf("bdwm.net")>=0?i.click(function(){return BDWM.redirect(n)}):i.click(function(){return window.open(n)})):void 0)}),e.from===this.activePeer.id?r.addClass("bdwm-chatting-main-message-chat-left"):r.addClass("bdwm-chatting-main-message-chat-right"),r.attr("data-message-id",e.id),r},t.prototype.parseTimeItem=function(e){var t;return t=$("<div class='bdwm-chatting-main-message bdwm-chatting-main-message-info' data-time='"+e.getTime()+"'> <span>"+BDWM.date2String(e)+"</span> </div>")},t.prototype.timeGap=function(e,t){return null===e||null===t||Math.abs(e.getTime()-t.getTime())>24e4},t.prototype.showMessages=function(e){return this.trigger("getMessages",e)},t.prototype.onMessages=function(e,t){var i,n,a,r;if(r=this,null!==this.activePeer&&this.activePeer.id===e.id)return n=this.body.find(".bdwm-chatting-main-message-wrapper"),i=null,a=null,t=_.sortBy(t,function(e){return-e.time.valueOf()}),t.length&&r.isOpen()&&r.trigger("setRead",e),n.children().length>0?_.each(t,function(e){return r.insertMessage(e)}):(_.each(t,function(e){var t;return t=r.parseMessageItem(e),null===i&&(i=e.time),r.timeGap(i,e.time)&&(n.prepend(r.parseTimeItem(a)),r.mainTopTime=a,null===r.mainBottomTime&&(r.mainBottomTime=a),i=a),a=e.time,n.prepend(t)}),a&&(n.prepend(r.parseTimeItem(a)),r.mainTopTime=a,null===r.mainBottomTime&&(r.mainBottomTime=a)),this.scrollToBottom())},t.prototype.insertMessage=function(e){var t,i,n,a,r,o,s;if(e)return s=this,a=this.parseMessageItem(e),t=this.body.find(".bdwm-chatting-main-message-wrapper"),r=t.find('[data-message-id="'+e.id+'"]'),i=!1,n=null,r.length>0?(r.replaceWith(a),i=!0):(o=t.find("[data-message-id],[data-time]"),o.length>0&&o.each(function(){var t,r,o;if(r=$(this),t=r.attr("data-message-id"),o=r.attr("data-time"),t){if(t>0&&t>e.id)return(null===n||e.time.getTime()-n>3e5)&&r.before(s.parseTimeItem(e.time)),r.before(a),i=!0,!1}else if(o)return o>e.time.getTime()?((null===n||e.time.getTime()-n>3e5)&&r.before(s.parseTimeItem(e.time)),r.before(a),i=!0,!1):n=o})),i||((null===n||e.time.getTime()-n>3e5)&&t.append(s.parseTimeItem(e.time)),t.append(a)),e.id>0&&(!this.mainMessageMax||this.mainMessageMax<e.id)&&(this.mainMessageMax=e.id),e.id>0&&(!this.mainMessageMin||this.mainMessageMin>e.id)&&(this.mainMessageMin=e.id),this.fixAtBottom()},t.prototype.deletePeer=function(e){return this.activePeer&&this.activePeer.id===e.id&&this.changeActivePeer(null),this.trigger("deletePeer",e)},t.prototype.sendMessage=function(e){if(null!==this.activePeer)return this.trigger("sendMessage",{to:this.activePeer,message:e},function(e){})},t.prototype.changeActivePeer=function(e){var t,i;if(this.textareaBuffer||(this.textareaBuffer=[]),e!==this.activePeer||null===this.activePeer)return i=this.body.find('[data-role="bdwm-chatting-new-message"]'),null!==this.activePeer&&(this.textareaBuffer[this.activePeer.id]=i.val()),null!==e?i.val(this.textareaBuffer[e.id]):i.val(""),this.activePeer&&e&&this.activePeer.id===e.id||this.body.find(".bdwm-chatting-main-message-wrapper").children().remove(),this.activePeer=e,this.trigger("setActivePeer",e),null===e||"deliver"===e.id?(i.attr("disabled","disabled"),this.body.find(".bdwm-chatting-main-name").text("")):(i.removeAttr("disabled"),this.body.find(".bdwm-chatting-main-name").text(e.name),t=i.val().length,i.focus().selection("setPos",{start:t,end:t}).change()),setTimeout(this.showList.bind(this),50),null!==e&&this.showMessages(e),!0},t.prototype.scrollToBottom=function(){var e;return e=this.body.find(".bdwm-chatting-main-content"),e.scrollTop(e.children().height()-e.height()+100),e.perfectScrollbar("update")},t.prototype.fixAtBottom=function(){var e;if(e=this.body.find(".bdwm-chatting-main-content"),e.scrollTop()+e.height()>=e.children().height()-80)return this.scrollToBottom()},t.prototype.showSearchList=function(e){var t,i,n;return n=this,t=this.body.find(".bdwm-chatting-main-list >div:first-child"),t.children().remove(),n.searchFirst=null,i=0,this.trigger("getSearchList",e,function(e){return _.each(e,function(e){var a;return i++,1===i&&(n.searchFirst=e),a=$("<div><span class='bdwm-chatting-main-list-avatar'><img ></span><span class='bdwm-chatting-main-list-name limit'></span><span class='bdwm-chatting-main-list-right-arrow'><i class='bdwm-chatting-iconfont'>&#xe647;</i></span><i data-action=\"bdwm-chatting-main-list-delete\" class='bdwm-chatting-iconfont' style=\"display: none\">&#xe6de;</i></div>"),a.find(".bdwm-chatting-main-list-name").text(e.name),e&&e.avatar.length>0&&a.find(".bdwm-chatting-main-list-avatar >img").attr("src",e.avatar),a.attr("data-peer-id",e.id),a.click(function(){return n.endSearch(),n.changeActivePeer(e),!0}),t.append(a),!0})})},t}(),{updatePeerInfo:function(e){return this.body.find('[data-peer-id="'+e.id+'"] img').attr("src",e.avatar)}}}.call(),function(){return window.BDWM||(window.BDWM={}),window.BDWM.Chatting=function(){function e(e){this.options=null!=e?e:{},"undefined"!=typeof username&&""!==username&&(this.uid=username,this.skey=BDWM.getCookie("skey"),this.storage=new BDWM.ChattingStorage({selfId:this.uid}),this.self=this.storage.selfPeer,this.timeoutJobs={},this.initConnector()&&this.initComponents(),this.intiTimeoutJobs(),this.initUserinfoAutoUpdate())}return e.prototype.intiTimeoutJobs=function(){return _.each(this.timeoutJobs,function(e){if(e.remain||(e.remain=e.timespan),e.remain--,e.remain<=0)return e.func.call(),e.remain=e.timespan}),setTimeout(this.intiTimeoutJobs.bind(this),1e3)},e.prototype.triggerTimeoutJob=function(e){var t;if(this.timeoutJobs[e])return t=this.timeoutJobs[e],t.func.call(),t.remain=t.timespan},e.prototype.initConnector=function(){var e;return e=this,this.connector=new BDWM.ChattingConnector({uid:this.uid,key:this.skey,storage:this.storage}),!!this.connector.initialized&&(this.connector.onConnect(function(){}),this.connector.onUpdatePeer(function(e){return this.components.updatePeerInfo(e)}),this.connector.onMessage(function(t,i){var n;if(n=[],_.each(e.storage.getList(t.id),function(t){var i;if(i=e.storage.getMessage(t))return i.fromPeer=e.storage.getPeerOrNew(i.from),
        i.toPeer=e.storage.getPeerOrNew(i.to),n.push(i)}),e.components.onMessages(t,n),i)return t.hide=!1,e.storage.setPeer(t),e.triggerTimeoutJob("getMessageUnreadCounts")}),this.timeoutJobs.getMessageUnreadCounts={timespan:90,func:function(){return e.connector.doGetMessageUnreadCounts(function(t){var i,n;if(n=!1,t&&(_.each(t,function(t){var i;if(i=e.storage.getPeerOrNew(t["with"].toLowerCase()),i.unread!==t.count)return n=!0,i.hide=!1,e.storage.setPeer(i)}),_.each(e.storage.peerList,function(t){var i;return i=e.storage.getPeerOrNew(t),i.unread=0,e.storage.setPeer(i)}),i=0,_.each(t,function(t){var n;return n=e.storage.getPeerOrNew(t["with"].toLowerCase()),n.unread=t.count,i+=t.count,e.storage.setPeer(n)}),e.storage.setUnread(i),e.components&&(e.components.showList(!1),e.components.setUnread(i),n&&e.components.startFlash(),0===i)))return e.components.stopFlash()})}},this.connector)},e.prototype.initComponents=function(){var e;return e=this,this.components=new BDWM.ChattingComponents(this.self),this.components.bind("getPeers",function(t,i){var n;if(i)return n=[],_.each(e.storage.peerList,function(t){return n.push(e.storage.getPeerOrNew(t))}),i(n)}),this.components.bind("setActivePeer",function(t,i){var n;if(i)return n=[],null!==t&&(e.storage.removeFromPeerList(t.id),e.storage.insertPeerList(t.id),t.hide=!1,t.unread=0,e.storage.setPeer(t)),_.each(e.storage.peerList,function(t){return n.push(e.storage.getPeerOrNew(t))}),i(n)}),this.components.bind("deletePeer",function(t,i){var n;if(i)return n=[],_.each(e.storage.peerList,function(i){if(n.push(e.storage.getPeerOrNew(i)),i===t.id)return t.hide=!0,e.storage.setPeer(t)}),i(n)}),this.components.bind("getSearchList",function(t,i){return e.connector.doSearchPeer(t,function(t){var n;return n=[],_.each(t,function(t){var i;if(i=e.storage.getPeer(t.username),i||(i=e.storage.getPeerOrNew(t.username),i.hide=!0),i.avatar=t.avatar||"",i.updatedAt=new Date,e.storage.setPeer(i),i.id!==e.uid)return n.push(i)}),i(n)})}),this.components.bind("sendMessage",function(t,i){var n;return n=t.to,e.connector.doSend(n,t.message,function(a){return a?(e.connector.loadNewMessages(n),i(!0)):(e.storage.setMessage(new BDWM.ChattingMessage({id:-(new Date).valueOf()/1e3,from:e.self.id,to:n.id,message:t.message,time:new Date,status:"failed"})),i(!1))})}),this.components.bind("getMessages",function(t,i){return e.connector.loadNewMessages(t)}),this.components.bind("setRead",function(t,i){return t=e.storage.getPeerOrNew(t.id),t.unread=0,e.storage.setPeer(t),e.connector.doSetMessageRead(t.id)})},e.prototype.initUserinfoAutoUpdate=function(){var e;return e=this,this.timeoutJobs.updateFriends={timespan:600,func:function(){return e.connector.doGetFriends(function(t){if(t)return _.each(t,function(t){var i;return i=e.storage.getPeerOrNew(t.uinfo.username),i.avatar=t.uinfo.avatar,i.name=t.uinfo.username,i.updatedAt=new Date,e.storage.setPeer(i)})})}},e.triggerTimeoutJob("updateFriends"),this.timeoutJobs.updateUserinfo={timespan:600,func:function(){var t;if(t=[],_.each(e.storage.peerList,function(i){var n;if(n=e.storage.getPeer(i),!n||""===n.avatar||!n.updatedAt||(new Date).getTime()-n.updatedAt.getTime()<72e5)return t.push(i)}),t.length>0)return e.connector.getUserinfoByNames(t,function(t){if(t)return _.each(t,function(t){var i;if(t)return i=e.storage.getPeerOrNew(t.username),i.avatar=t.avatar,i.name=t.username,i.updatedAt=new Date,e.storage.setPeer(i)})})}},setTimeout(function(){return e.triggerTimeoutJob("updateUserinfo")},5e3)},e.prototype.connect=function(){return!!this.connector.initialized&&(this.connector.connect(),!0)},e.prototype.disconnect=function(){return!!this.connector.initialized&&(this.connector.disconnect(),!0)},e.prototype.chatWith=function(e){var t;return this.components.open(),t=this.storage.getPeer(e.toLowerCase()),!t||t.hide?this.components.startSearch(e):(this.components.stopSearch(),this.components.changeActivePeer(t))},e}()}.call(),function(){function e(e,t){if(!p){var i=$("#page-content").find("#bdwm-friends-delete-modal");0==i.length&&(i=$(o).appendTo("#page-content")),i.find('[data-role="bdwm-deleting-friend-id"]').text(t),i.bdwm_dialog().show(),i.find('[data-action="delete-yes"]').unbind("click").click(function(){i.bdwm_dialog().hide(),p=!0,$.ajax({type:"POST",url:"ajax/set_friends.php",data:{action:"delete",uid:e},dataType:"json",timeout:4e3}).done(function(e){p=!1,e.success?BDWM.alert({text:"成功取消关注",callback:BDWM.reload,timeout:2e3}):BDWM.alert({text:"失败啦，请稍候再试"})}).fail(function(e){p=!1,BDWM.alert({text:"网络错误,请稍候重试"})})})}}function t(e){if(!p){var t=$("#page-content").find("#bdwm-friends-edit-remark-modal");0==t.length&&(t=$(s).appendTo("#page-content")),t.bdwm_dialog().show(),t.find('[data-role="bdwm-friend-edit-remark-input"]').unbind("keydown").on("keydown",function(e){13==e.keyCode&&t.find('[data-action="edit-remark-yes"]').click()}),t.find('[data-action="edit-remark-yes"]').unbind("click").click(function(){t.bdwm_dialog().hide();var i=t.find('[data-role="bdwm-friend-edit-remark-input"]').val();p=!0,$.ajax({type:"POST",url:"ajax/set_friends.php",data:{action:"add",uid:e,desc:i},dataType:"json",timeout:4e3}).done(function(e){p=!1,e.success?BDWM.alert({text:"成功设置备注",callback:BDWM.reload,timeout:2e3}):BDWM.alert({text:"设置备注失败,请稍候重试"})}).fail(function(e){p=!1,BDWM.alert({text:"网络错误,请稍候重试"})})})}}function i(e,t,i){if(!p){var n=$("#page-content").find("#bdwm-friends-adding-model");0==n.length&&(n=$(d).appendTo("#page-content")),n.find('[data-role="bdwm-adding-friend-id"]').text(t),n.bdwm_dialog().show(),n.find('[data-action="adding-yes"]').unbind("click").click(function(){n.bdwm_dialog().hide(),p=!0,$.ajax({type:"POST",url:"ajax/set_friends.php",data:{action:"add",uid:e,desc:i},dataType:"json",timeout:4e3}).done(function(e){p=!1,e.success?BDWM.alert({text:"成功关注",callback:BDWM.reload,timeout:2e3}):BDWM.alert({text:"关注失败,请稍后重试"})}).fail(function(e){p=!1,BDWM.alert({text:"网络错误,请稍候重试"})})})}}function n(e,t,i){if(!p){var n=$("#page-content").find("#bdwm-blacklist-friend-modal");0==n.length&&(n=$(c).appendTo("#page-content")),n.find('[data-role="bdwm-blacklist-friend-id"]').text(t),n.bdwm_dialog().show(),n.find('[data-action="blacklist-yes"]').unbind("click").click(function(){n.bdwm_dialog().hide(),p=!0,$.ajax({type:"POST",url:"ajax/set_friends.php",data:{action:"add",mode:"reject",uid:e,desc:i},dataType:"json",timeout:4e3}).done(function(e){p=!1,e.success?BDWM.alert({text:"成功拉入黑名单",callback:BDWM.reload,timeout:2e3}):BDWM.alert({text:"失败啦,请稍后再试"})}).fail(function(e){p=!1,BDWM.alert({text:"网络错误,请稍后再试"})})})}}function a(e,t,i){if(!p){var n=$("#page-content").find("#bdwm-unblacklist-friend-modal");0==n.length&&(n=$(l).appendTo("#page-content")),n.find('[data-role="bdwm-unblacklist-friend-id"]').text(t),n.bdwm_dialog().show(),n.find('[data-action="unblacklist-yes"]').unbind("click").click(function(){n.bdwm_dialog().hide(),p=!0,$.ajax({type:"POST",url:"ajax/set_friends.php",data:{action:"delete",mode:"reject",uid:e},dataType:"json",timeout:4e3}).done(function(e){p=!1,e.success?BDWM.alert({text:"成功从黑名单中移除",callback:BDWM.reload,timeout:2e3}):BDWM.alert({text:"失败啦,请稍后再试"})}).fail(function(e){p=!1,BDWM.alert({text:"网络错误,请稍后再试"})})})}}function r(e){if(!p){var t=$("#page-content").find("#bdwm-blacklist-friends-edit-remark-modal");0==t.length&&(t=$(h).appendTo("#page-content")),t.bdwm_dialog().show(),t.find('[data-role="bdwm-blacklist-friend-edit-remark-input"]').unbind("keydown").on("keydown",function(e){13==e.keyCode&&t.find('[data-action="edit-remark-yes"]').click()}),t.find('[data-action="edit-remark-yes"]').unbind("click").click(function(){t.bdwm_dialog().hide();var i=t.find('[data-role="bdwm-blacklist-friend-edit-remark-input"]').val();p=!0,$.ajax({type:"POST",url:"ajax/set_friends.php",data:{action:"add",mode:"reject",uid:e,desc:i},dataType:"json",timeout:4e3}).done(function(e){p=!1,e.success?BDWM.alert({text:"成功设置黑名单备注",callback:BDWM.reload,timeout:2e3}):BDWM.alert({text:"设置黑名单备注失败,请稍后重试"})}).fail(function(e){p=!1,BDWM.alert({text:"网络错误,请稍后重试"})})})}}var o='<div id="bdwm-friends-delete-modal" class="bdwm-friends-modal"> <p>是否取消关注<span class="red" data-role="bdwm-deleting-friend-id">USERID</span>?</p> <div class="buttons"> <a class="primary" data-action="delete-yes">确认</a> <a data-action="dialog-dismiss">取消</a> </div> </div>',s=' <div id="bdwm-friends-edit-remark-modal" class="bdwm-friends-modal"> <p><label>备注</label><input data-role="bdwm-friend-edit-remark-input" type="text"></p> <div class="buttons"> <a class="primary" data-action="edit-remark-yes">确认</a> <a data-action="dialog-dismiss">取消</a> </div> </div>',d='<div id="bdwm-friends-adding-modal" class="bdwm-friends-modal"> <p>是否关注<span class="red" data-role="bdwm-adding-friend-id">USERID</span>?</p> <div class="buttons"> <a class="primary" data-action="adding-yes">确认</a><a data-action="dialog-dismiss">取消</a> </div> </div>',c='<div id="bdwm-blacklist-friend-modal" class="bdwm-friends-modal"> <p>是否拉黑<span class="red" data-role="bdwm-blacklist-friend-id">USERID</span>?</p> <div class="buttons"> <a class="primary" data-action="blacklist-yes"> 确认</a><a data-action="dialog-dismiss"> 取消</a></div></div>',l='<div id="bdwm-unblacklist-friend-modal" class="bdwm-friends-modal"><p>是否将<span class="red" data-role="bdwm-unblacklist-friend-id">USERID</span>移出黑名单?</p><div class="buttons"><a class="primary" data-action="unblacklist-yes">确认</a><a data-action="dialog-dismiss">取消</a></div></div>',h='<div id="bdwm-blacklist-friends-edit-remark-modal" class="bdwm-friends-modal"><p><label>备注</label><input data-role="bdwm-blacklist-friend-edit-remark-input" type="text"></p><div class="buttons"><a class="primary" data-action="edit-remark-yes">确认</a><a data-action="dialog-dismiss">取消</a></div></div>',p=!1;window.BDWM||(window.BDWM={}),window.BDWM.deleteFriend=e,window.BDWM.editFriendRemark=t,window.BDWM.makeFriend=i,window.BDWM.blacklistFriend=n,window.BDWM.unBlacklistFriend=a,window.BDWM.editBlacklistFriendRemark=r}();var BDWM_SEARCH_BOX_HTML,bind=function(e,t){return function(){return e.apply(t,arguments)}},extend=function(e,t){function i(){this.constructor=e}for(var n in t)hasProp.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;window.BDWM||(window.BDWM={}),BDWM_SEARCH_BOX_HTML='<input class="search-ipt" type="text" placeholder="搜索版面、帖子、用户" autocomplete="off">\n<img class="search-btn" src="images/home/iconfont-sousuo.png">\n<ul class="search-result box-shadow keywords-result">\n</ul>\n<ul class="search-result box-shadow history-result">\n</ul>',window.BDWM.SearchBox=function(){function e(e,t){var i,n;this.$element=e,this.options=null!=t?t:{},this.confirm=bind(this.confirm,this),this.keyControl=bind(this.keyControl,this),this.changeManager=bind(this.changeManager,this),this.blur=bind(this.blur,this),this.focus=bind(this.focus,this),i=$(BDWM_SEARCH_BOX_HTML),this.$element.append(i),this.$element.addClass("bdwm-search-box"),this.$input=this.$element.find(".search-ipt"),this.$input.focus(this.focus),this.$input.attr("placeholder",this.options.placeholder),this.randomId=Math.floor(23175468*Math.random())+1,this.$input.click(function(e){return e.stopPropagation()}),this.$input.keydown(this.keyControl),this.$element.find(".search-btn").click(this.confirm),this.options.tips&&(this.$keywordResult=this.$element.find(".keywords-result"),this.tipManager=new window.BDWM.SearchBox.TipManager(this.$keywordResult,this.$input,this.options.tips)),this.options.history&&(this.$historyResult=this.$element.find(".history-result"),n={confirm:this.options.confirm,name:this.options.name},this.historyManager=new window.BDWM.SearchBox.HistoryManager(this.$historyResult,this.$input,n)),this.manager=null}return e.prototype.focus=function(){return this.changeManager(),this.options.focus&&this.options.focus(),$("body").one("click",function(e){return function(t){return e.blur()}}(this))},e.prototype.blur=function(e){return setTimeout(function(e){return function(){if(e.manager&&e.manager.hide(),e.options.blur)return e.options.blur()}}(this),120)},e.prototype.changeManager=function(){var e;if(e=this.$input.val(),e.length>0?(this.manager=this.tipManager,this.historyManager&&this.historyManager.hide()):(this.manager=this.historyManager,this.tipManager&&this.tipManager.hide()),this.manager&&!this.manager.visible())return this.manager.show()},e.prototype.keyControl=function(e){if(13===e.which&&this.confirm(),this.manager&&(38===e.which&&this.manager.prev(),40===e.which&&this.manager.next()),setTimeout(this.changeManager,100),38===e.which||40===e.which)return!1},e.prototype.confirm=function(){return this.manager&&this.manager.confirmItem()||(this.options.confirm(this.$input.val()),this.historyManager&&this.historyManager.appendCurrentKey()),this.$input.blur(),setTimeout(function(e){return function(){if(e.manager)return e.manager.hide()}}(this),100)},e}(),window.BDWM.SearchBox.ItemManager=function(){function e(){this.hide=bind(this.hide,this),this.show=bind(this.show,this),this.currentIndex=-1,this.items=[],this.$element.on("click",">li",function(e){return function(t){var i;return i=$(t.target).data("index"),e.confirm(e.items[i]),e.$element.focusout()}}(this)),this.$element.on("mouseenter",">li",function(e){return function(t){return e.currentIndex=$(t.target).data("index"),e.refreshCurrentSelection()}}(this))}return e.prototype.prev=function(){return this.currentIndex-=1,this.currentIndex<0&&(this.currentIndex=0),this.refreshCurrentSelection()},e.prototype.next=function(){return this.currentIndex+=1,this.currentIndex>=this.items.length&&(this.currentIndex=this.items.length-1),this.refreshCurrentSelection()},e.prototype.refreshCurrentSelection=function(){if(this.$element.find("li").removeClass("active"),!(null==this.currentIndex||this.currentIndex<0))return this.items[this.currentIndex].$element.addClass("active")},e.prototype.confirmItem=function(){return!(this.currentIndex<0)&&(this.items[this.currentIndex].$element.click(),this.$input.blur(),!0)},e.prototype.show=function(){if(this.items.length>0)return this.$element.show()},e.prototype.hide=function(){return this.currentIndex=-1,this.$element.hide()},e.prototype.visible=function(){return this.$element.is(":visible")},e}(),window.BDWM.SearchBox.TipManager=function(e){function t(e,i,n){this.$element=e,this.$input=i,this.options=n,this.hide=bind(this.hide,this),this.refreshResult=bind(this.refreshResult,this),this.refreshRequest=bind(this.refreshRequest,this),this.requestable=!0,this.currentKeyword="",this.$input.keyup(this.refreshRequest),this.confirm=this.options.confirm,t.__super__.constructor.call(this)}return extend(t,e),t.prototype.refreshRequest=function(e){var t,i,n;if((!e||13!==(i=e.which)&&38!==i&&40!==i)&&(t=this.$input.val(),this.requestable&&!(t===this.currentKeyword||t.length<1)))return this.options.url?(this.requestable=!1,setTimeout(function(e){return function(){return e.requestable=!0,e.refreshRequest()}}(this),500),n={pref:t},this.options.generateRequestParams&&(n=this.options.generateRequestParams(t)),$.ajax({url:this.options.url,dataType:"json",timeout:2e3,type:"POST",data:n}).done(this.refreshResult(t))):this.refreshResult(t)()},t.prototype.htmlEncode=function(e){var t;return t=$("<span></span>"),t.text(e),t.html()},t.prototype.highlight=function(e,t){var i,n;for(i=e.indexOf(t),n="";i>=0;)n+=e.substr(0,i)+"<strong>"+t+"</strong>",e=e.substr(i+t.length),i=e.indexOf(t);return e&&(n+=e),n},t.prototype.refreshResult=function(e){return function(t){return function(i){var n,a,r,o,s,d,c;for(t.currentKeyword=e,t.items=t.options.getItemsFromData(i,e),a=0,t.$element.html(""),d=t.items,o=0,s=d.length;o<s;o++)r=d[o],n=$("<li></li>"),n.data("index",a),t.items[a].$element=n,t.items[a].text&&(c=t.htmlEncode(t.items[a].text),n.html(t.highlight(c,t.htmlEncode(e)))),t.options.modifyViewFromItem&&t.options.modifyViewFromItem(r,n,t.htmlEncode(e)),t.$element.append(n),a+=1;return t.currentIndex=-1,t.show()}}(this)},t.prototype.hide=function(){if(t.__super__.hide.call(this),this.$input.val()!==this.currentKeyword)return this.items=[],this.currentKeyword=""},t}(window.BDWM.SearchBox.ItemManager),window.BDWM.SearchBox.HistoryManager=function(e){function t(e,i,n){this.$element=e,this.$input=i,this.options=n,this.available=BDWM.storage.available,this.name=this.options.name,t.__super__.constructor.call(this)}return extend(t,e),t.prototype.confirm=function(e){return this.options.confirm(e.str)},t.prototype.getList=function(){var e;return this.available?(e=JSON.parse(BDWM.storage.get(this.name)),e?e:[]):[]},t.prototype.setList=function(e){if(this.available)return BDWM.storage.set(this.name,JSON.stringify(e))},t.prototype.append=function(e){var t;if(this.available&&e.length>0){for(t=this.getList().filter(function(t){return t!==e}),t.push(e);t.length>5;)t.shift();return this.setList(t)}},t.prototype.clear=function(){if(this.available)return BDWM.storage.remove(this.name)},t.prototype.refreshResult=function(){var e,t,i,n,a,r,o,s;for(this.$element.html(""),s=this.getList().reverse(),this.items=[],i=0,a=0,o=s.length;a<o;a++)r=s[a],t=$("<li></li>"),n={str:r,$element:t},this.items.push(n),t.html(r),t.data("index",i),i+=1,this.$element.append(t);return e=$('<li style="text-align: center; cursor: pointer;">清除搜索记录</li>'),e.data("index",-1),e.click(function(e){return function(t){return e.hide(),e.clear(),t.stopPropagation()}}(this)),e.mouseenter(function(){return $(this).addClass("force-active")}),e.mouseleave(function(){return $(this).removeClass("force-active")}),this.$element.append(e)},t.prototype.appendCurrentKey=function(){return this.append(this.$input.val())},t.prototype.show=function(){return this.refreshResult(),t.__super__.show.call(this)},t}(window.BDWM.SearchBox.ItemManager),window.BDWM.searchBox=function(e,t){return e.html(""),new BDWM.SearchBox(e,t)};